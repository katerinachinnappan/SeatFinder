/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2016, 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apiconnect-apim-client

'use strict';

var _ = require('lodash');
var f = require('util').format;
var reqOpts = require('./req-options');
var request = require('./request');
var validator = require('./opts-validator');

function list(options) {
  options = options || {};
  return validator(options, [ 'organization', 'catalog' ]).then(function() {
    if (options.space) {
      options = reqOpts(_.defaults({
        url: f(
          '/v1/orgs/%s/environments/%s/spaces/%s/consumerApps?consumerAppsOnly=true',
          options.organization,
          options.catalog,
          options.space
        ),
        json: true,
      }, options));
    } else {
      options = reqOpts(_.defaults({
        url: f('/v1/orgs/%s/environments/%s/consumerApps?consumerAppsOnly=true', options.organization, options.catalog),
        json: true,
      }, options));
    }

    return request(options);
  });
};

function get(options) {
  options = options || {};
  return validator(options, [ 'organization', 'catalog', 'name' ]).then(function() {
    if (options.space) {
      options = reqOpts(_.defaults({
        url: f(
          '/v1/orgs/%s/environments/%s/spaces/%s/consumerApps/%s',
          options.organization,
          options.catalog,
          options.space,
          options.name
        ),
        json: true,
      }, options));
    } else {
      options = reqOpts(_.defaults({
        url: f(
          '/v1/orgs/%s/environments/%s/consumerApps/%s',
          options.organization,
          options.catalog,
          options.name
        ),
        json: true,
      }, options));
    }

    return request(options);
  });
};

module.exports = {
  list: list,
  get: get,
};

