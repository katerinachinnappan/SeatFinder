<!--
/********************************************************* {COPYRIGHT-TOP} ***
* Licensed Materials - Property of IBM
* 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
*
* (C) Copyright IBM Corporation 2017
*
* All Rights Reserved.
* US Government Users Restricted Rights - Use, duplication or disclosure
* restricted by GSA ADP Schedule Contract with IBM Corp.
********************************************************** {COPYRIGHT-END} **/
-->
<h2 class="bx--modal-content__heading" role="banner" aria-label="{{'manageMigrateTitle' | translate}}">
  <div class="bx--form__legend modal-title floatLeft">{{'manageMigrateTitle' | translate}}</div>
  <div class="bx--form__legend floatRight">{{currentPage}} / {{pageCount}}</div>
  <div class="clearBoth"></div>
</h2>
<button title="Close" class="bx--modal__close" type="button" data-ng-click="cancel()" tabindex="-1">
  <bx-icon class="bx--modal__close--icon" icon="close"></bx-icon>
</button>
<div class="bx--modal-content" data-ng-switch="currentPage">
  <div data-ng-switch-default>
    <div style="margin-bottom: 15px;">{{'manageMigrateApps' | translate}}</div>
    <div class="searchCollection unifiedSearch" style="margin-bottom: 15px;">
      <input class="dijitInline bx--text__input" data-ng-model="appQuery" type="text" spellcheck="false" title="{{'find' | translate}}" placeholder="{{'find' | translate}}">
      <button class="iconOnlyButton" title="{{'find' | translate}}"><span class="searchIcon"></span></button>
    </div>
    <div class="primaryBorder">
      <div class="tableHeaderBackground bxTableHeader" style="border-top: none;">
        <div class="column appSelectColumn">
          <bx-checkbox data-ng-model="$parent.selectAll" data-ng-click="selectAllSubscriptions()" bx-prevent-default="true" title="{{::'selectAll' | translate}}"></bx-checkbox>
        </div>
        <div class="column appNameColumn">{{'application' | translate}}</div>
        <div class="column appOrgColumn">{{'orgName' | translate}}</div>
      </div>
      <div data-ng-class="{'spinner': refreshingSubscriptions}"></div>
      <ul data-ng-show="!refreshingSubscriptions" class="simpleList appSubscriptions cardContainer">
        <li data-ng-repeat="versionSubscription in $parent.filteredVersionSubscriptions = (subscriptions | appSubscriptionQuery: appQuery)" ng-class-even="'bxTableRowEven'" ng-class-odd="'bxTableRowOdd'">
          <apim-app-subscription></apim-app-subscription>
        </li>
      </ul>
      <div class="mediumPadding" data-ng-show="!refreshingSubscriptions && filteredVersionSubscriptions.length == 0">{{subscriptions | deploymentSubscribers: planVersion | deploymentReplaceNoAppSubscriptions}}</div>
    </div>
    <div data-ng-show="!refreshingSubscriptions" style="margin-top: 10px;">{{filteredVersionSubscriptions | selectedSubscriptionsCount}}</div>
  </div>

  <div data-ng-switch-when="2">
    <div style="margin-bottom: 15px;">{{'manageMigrateTarget' | translate}}</div>
    <div class="searchCollection unifiedSearch" style="margin-bottom: 15px;">
      <input class="dijitInline bx--text__input" data-ng-model="planVersionQuery" type="text" spellcheck="false" title="{{'find' | translate}}" placeholder="{{'find' | translate}}"><button
      class="iconOnlyButton" title="{{'find' | translate}}"><span class="searchIcon"></span></button>
    </div>

    <div class="primaryBorder">
      <div class="tableHeaderBackground minimalPlanVersion bxTableHeader" style="border-top: none;">
        <div class="column manageProductPlanNameColumn">{{'plansPlural' | translate}}</div>
      </div>
      <div data-ng-if="loadingPlanVersions" class="">{{loading | translate}}</div>
      <div>
      <ul class="simpleList productVersions boundedList">
        <li class="mediumPadding" data-ng-if="!loadingPlanVersions && filteredProductVersions.length == 0">{{productVersions | deploymentProductReplaceNoDescriptors: planVersionQuery}}</li>

        <li data-ng-if="productVersions.length > 0" data-ng-repeat="otherProductVersion in filteredProductVersions = (productVersions | deploymentNameOnlyQuery: planVersionQuery | publishedProductVersionsExcludingPlan: productVersion)">
           <div class="tableHeaderBackground minimalPlanVersion" style="font-size: medium;" data-ng-bind-html="otherProductVersion.document.info.title + ' ' + otherProductVersion.productVersion | highlight: planVersionQuery"></div>
          <ul class="planVersions">
            <li data-ng-repeat="planVersion in otherProductVersion.dependents.PLANVERSION">
              <apim-deployed-product-plan data-ng-click="planVersionSelected(planVersion.planName, otherProductVersion)" class="minimalPlanVersion"></apim-deployed-product-plan>
            </li>
          </ul>
        </li>
      </ul>
      </div>
    </div>

  </div>
</div>
<div class="bx--modal__buttons" role="contentinfo" aria-label="{{'footerSectionLabel' | translate}}">
  <div class='bx--modal__buttons-container'>
    <button class="bx--btn--secondary no-animate" data-ng-show="currentPage > 1" data-ng-click="currentPage = 1">{{'planPublishBack' | translate}}</button>
    <button class="bx--btn--secondary" data-ng-click="cancel()">{{'cancel' | translate}}</button>
    <button class="bx--btn no-animate" data-ng-show="currentPage < pageCount" data-ng-disabled="!subscriptionsSelected" data-ng-click="migratingSubscription = true; next()">{{'planPublishNext' | translate}}</button>
    <button class="bx--btn no-animate" data-ng-show="currentPage == 2" data-ng-disabled="!selectedPlanName || !selectedProductVersion" data-ng-click="migrateVersion(selectedPlanName, selectedProductVersion)">{{'manageMigrateAction' | translate}}</button>
  </div>
</div>
