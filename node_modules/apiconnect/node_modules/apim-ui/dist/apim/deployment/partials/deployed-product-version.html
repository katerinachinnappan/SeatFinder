<!--
/********************************************************* {COPYRIGHT-TOP} ***
* Licensed Materials - Property of IBM
* 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
*
* (C) Copyright IBM Corporation 2017
*
* All Rights Reserved.
* US Government Users Restricted Rights - Use, duplication or disclosure
* restricted by GSA ADP Schedule Contract with IBM Corp.
********************************************************** {COPYRIGHT-END} **/
-->
<div class="card primaryBorder" data-ng-class="{'backgroundDisabled': xhrProcessing, 'open': (showVersionDetails) || (selectedProductVersion && selectedProductVersion.deploymentPackageId == productVersion.deploymentPackageId)}" data-ng-controller="DeployedProductVersionController as productVersionController">
	<div class="productVersion">
		<div class="displayInline alignTop manageProductNameColumn" style="outline: none;" data-ng-click="showVersionDetails = !showVersionDetails; setExpanded(productVersion, showVersionDetails);">
			<span class="secondaryText" style="margin-left: 10px;" data-ng-bind-html="productVersion.productTitle + ':' + productVersion.productVersion | highlight: productVersionQuery"></span>
		</div><div class="displayInline alignTop manageProductSimpleNameColumn">
			<a class="documentName"></a>
			<div class="secondaryText displayInline" data-ng-bind-html="productVersion.productName + ':' + productVersion.productVersion | highlight: productVersionQuery"></div>
		</div><div
			class="displayInline alignTop manageProductStateColumn">
			<div class="mobileLabel">{{'deploymentState' | translate}}: </div>
			<div class='displayInline deployedProduct {{productVersion.deploymentState}}'>
				<div class='deploymentLabel boundedText manageProductStateColumn' title="{{'manage_' + productVersion.deploymentState | translate}}">
					<span>{{'manage_' + productVersion.deploymentState | translate}}</span>
					<span class="secondaryText" style="margin-left: 10px; font-weight: normal;">{{productVersion.updatedAt | since}}</span>
				</div>
				<div data-ng-show="productVersion.pendingDeploymentState && !permissions[spaceId ? spaceId + '/space_productDeploymentApproval/' + productVersion.pendingDeploymentState : environment.id + '/catalog_productDeploymentApproval/' + productVersion.pendingDeploymentState]" style="margin-top: -33px;" class="secondaryText">{{'approvalPendingApproval_' + productVersion.pendingDeploymentState | translate}}</div>
				<div data-ng-show="productVersion.pendingDeploymentState && permissions[spaceId ? spaceId + '/space_productDeploymentApproval/' + productVersion.pendingDeploymentState : environment.id + '/catalog_productDeploymentApproval/' + productVersion.pendingDeploymentState]" style="margin-top: -33px;" class="secondaryText"><a href='#/catalogs/{{environment.id}}/approvals'>{{'approvalPendingApproval_' + productVersion.pendingDeploymentState | translate}}</a></div>
			</div>
		</div><div
    class="displayInline alignTop manageProductActionsColumn">

		<div class="dijitInline contentBox" data-ng-show="permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage'] || permissions['org_draftProducts/view']">
					<bx-overflow-menu >
						<!-- state transition: retired - > staged -->
						<bx-overflow-menu-item item-text="{{'manageRestage' | translate}}" data-ng-show="(productVersion.deploymentState == 'retired') && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage']" data-ng-click="stage();">
						</bx-overflow-menu-item>

						<!-- state transition: staged -> published, deprecated -> published -->
						<bx-overflow-menu-item item-text="{{'managePublish' | translate}}" data-ng-show="(productVersion.deploymentState == 'staged' || productVersion.deploymentState == 'deprecated') && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage']" data-ng-click="availability(true);">
						</bx-overflow-menu-item>

						<!-- state transition: published -> deprecated -->
						<bx-overflow-menu-item item-text="{{'manageDeprecate' | translate}}" data-ng-show="productVersion.deploymentState == 'published' && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage']" data-ng-click="deprecate();">
						</bx-overflow-menu-item>

						<!-- state transition: published -> retired, deprecated -> retired -->
						<bx-overflow-menu-item item-text="{{'manageRetire' | translate}}" data-ng-show="(productVersion.deploymentState == 'deprecated' || productVersion.deploymentState == 'published') && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage']" data-ng-click="retire();">
						</bx-overflow-menu-item>

						<!-- state transition: retired -> archived -->
						<bx-overflow-menu-item item-text="{{'manageArchive' | translate}}" data-ng-show="productVersion.deploymentState == 'retired' && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage']" data-ng-click="archive();">
						</bx-overflow-menu-item>

						<!-- state transition: archived -> retired -->
						<bx-overflow-menu-item item-text="{{'manageUnarchive' | translate}}" data-ng-show="(productVersion.deploymentState == 'archived') && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage']" data-ng-click="retireHelper(true);">
						</bx-overflow-menu-item>

						<!-- macro: replace -->
						<bx-overflow-menu-item item-text="{{'product_manage_replace' | translate}}" data-ng-show="(productVersion.deploymentState == 'staged' || productVersion.deploymentState == 'published' || productVersion.deploymentState == 'deprecated') && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage'] && otherPublishedOrDeprecatedProducts.length > 0" data-ng-click="replace();">
						</bx-overflow-menu-item>

						<!-- macro: supersede -->
						<bx-overflow-menu-item item-text="{{'product_manage_supersede' | translate}}" data-ng-show="(productVersion.deploymentState == 'staged' || productVersion.deploymentState == 'published' || productVersion.deploymentState == 'deprecated') && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage'] && otherPublishedProducts.length > 0" data-ng-click="supersede();">
						</bx-overflow-menu-item>

						<!-- edit migration target -->
						<bx-overflow-menu-item item-text="{{'manageEditMigrationTargets' | translate}}" data-ng-show="(productVersion.deploymentState == 'published' || productVersion.deploymentState == 'deprecated') && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage']" data-ng-click="setMigrationTargets();">
						</bx-overflow-menu-item>

						<!-- edit visibility -->
						<bx-overflow-menu-item item-text="{{'manageEditVisibility' | translate}}" data-ng-show="permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage']" data-ng-click="availability();">
						</bx-overflow-menu-item>

						<!--analytics -->
						<a data-ng-href="#/catalogs/{{environment.id}}/analytics?type=product&id={{productVersion.productName+':'+productVersion.productVersion}}&name={{productVersion.productName}}">
							<bx-overflow-menu-item item-text="{{::'subscriptionsProdAnalytics' | translate}}" data-ng-show="permissions[spaceId ? spaceId+'/space_spaceAnalytics/view' : environment.id+'/catalog_environmentAnalytics/view']">
							</bx-overflow-menu-item>
						</a>

						<!-- approvals -->
						<bx-overflow-menu-item item-text="{{'approvalHistoryItem' | translate}}" data-ng-show="permissions[spaceId ? spaceId+'/space_productDeploymentApproval/view' : environment.id+'/catalog_productDeploymentApproval/view']" data-ng-click="approvals();">
						</bx-overflow-menu-item>

						<!-- remove from environment -->
						<bx-overflow-menu-item item-text="{{'manageRemoveFromEnvironment' | translate}}"  data-ng-show="(productVersion.deploymentState == 'staged' || productVersion.deploymentState == 'retired' || productVersion.deploymentState == 'archived') && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage']" data-ng-click="remove();">
						</bx-overflow-menu-item>

					</bx-overflow-menu>
		</div>
  </div>
	<div class="deployedProductContent productPlans" data-ng-show="showVersionDetails">
		<!--<div ng-hide="productVersion.getProductsSuccess">{{::'loading' | translate}}</div>-->
		<div class="tableHeaderBackground" style="border: none;">
			<div class="column manageProductApiNameColumn">{{'apis' | translate}}</div><div
				class="column manageProductActionsColumn" data-ng-show="productVersion.deploymentState == 'published' || productVersion.deploymentState == 'deprecated'">{{'apiOnlineOffline' | translate}}</div>
		</div>
		<ul class="apiVersions" data-ng-show="productVersion.dependents.APIVERSION">
			<li data-ng-repeat="apiVersion in productVersion.dependents.APIVERSION | orderBy: 'apiName'" data-ng-controller="DeployedProductApiController">
				<div class="apiVersion secondaryBorder bottom" data-ng-class="{'backgroundDisabled': xhrProcessing}">
					<div class="displayInline alignTop manageProductApiNameColumn">
						<span data-ng-bind-html="apiVersion.apiName | highlight: query"></span>
						<span class="secondaryText" data-ng-bind-html="apiVersion.apiVersion"></span>
					</div><div
            class="displayInline alignTop manageProductActionsColumn" style="width: 105px;">
            <md-switch data-ng-disabled="changingState" data-ng-show="(productVersion.deploymentState == 'published' || productVersion.deploymentState == 'deprecated') && permissions[spaceId ? spaceId+'/space_productDeployment/manage' : environment.id+'/catalog_productDeployment/manage']" ng-change="toggleApi()" ng-model="apiToggled" md-no-ink aria-label="{{::'apiOnlineOffline' | translate}}" class="md-block"></md-switch>
					</div><div
            class="displayInline alignTop manageProductAnalyticsColumn">
            <div class="dijitInline productApiAnalytics">
              <a class="material-icons alignMiddle" data-ng-attr-href="#/catalogs/{{environment.id}}/analytics?type=api&id={{apiVersion.apiId}}&name={{apiVersion.apiName}}" title="{{'apiAnalytics' | translate}}">equalizer</a>
              <!--<button class="dijitInline iconOnlyButton  material-icons" title="Analytics" data-ng-click="displayAnalytics()" aria-disabled="false">equalizer</button>-->
            </div>
          </div>
				</div>
			</li>
		</ul>
		<div class="tableHeaderBackground" style="border: none; margin-top: 10px;">
			<div class="column manageProductPlanNameColumn">{{'plansPlural' | translate}}</div><div
				class="column manageProductPlanSubscribersColumn">{{'manageSubscribers' | translate}}</div><div
				class="column manageProductActionsColumn"></div>
		</div>
		<ul class="planVersions" data-ng-show="productVersion.dependents.PLANVERSION">
			<li data-ng-repeat="planVersion in productVersion.dependents.PLANVERSION | orderBy: 'planRegistrations': 'reverse'" data-ng-controller="ProductPlanController">
				<apim-deployed-product-plan></apim-deployed-product-plan>
			</li>
		</ul>
	</div>
</div>
