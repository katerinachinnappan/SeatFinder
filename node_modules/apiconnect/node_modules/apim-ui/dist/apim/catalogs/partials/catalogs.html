<!--
/********************************************************* {COPYRIGHT-TOP} ***
* Licensed Materials - Property of IBM
* 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
*
* (C) Copyright IBM Corporation 2017
*
* All Rights Reserved.
* US Government Users Restricted Rights - Use, duplication or disclosure
* restricted by GSA ADP Schedule Contract with IBM Corp.
********************************************************** {COPYRIGHT-END} **/
-->
<div class="catalogs centerColumn" data-ng-controller="CatalogsController">
  <div class="layout fullWidth searchBanner">
    <div class="dropdown" dropdown data-is-open="addEntityOpen" data-ng-show="permissions['org_catalogs/create']">
      <button class="bx--btn" role="button" title="{{::'add' | translate}}" dropdown-toggle>
        {{::'add' | translate}}
        <bx-icon class="bx--btn--right-icon__icon" icon="add--glyph"></bx-icon>
      </button>
      <ul class="dropdown-menu exclude-this" role="menu" onkeypress="addProductOpen = true;">
        <li role="menuitem"><a href="" data-ng-click="addCatalog();">{{::'catalogs_add' | translate}}</a></li>
        <li role="menuitem"><a href="" data-ng-click="addApp();" data-ng-show="collectives.length > 0">{{::'catalogs_add_app' | translate}}</a></li>
      </ul>
    </div>
    <div data-search-with-options class="displayInline itsAllRelative flex bx--search bx--search-with-options" role="search">
      <bx-icon class="bx--search__icon--magnifier" icon="search"></bx-icon>
      <label for="search-with-options__input" class="bx--search__label">Search</label>
      <input type="search" class="bx--search__input" id="search-with-options__input" aria-label="{{::'catalogs_search' | translate}}" placeholder="{{::'catalogs_search' | translate}}" data-ng-model="query" data-ng-disabled="!environments.$resolved">
      <button type="reset" class="iconOnlyButton" data-ng-click="query = ''" data-ng-show="query" title="{{::'resetFilter' | translate}}">
        <div class="closeIcon"></div>
      </button>
      <button class="bx--search__toggle-layout" type="button"
        data-ng-click="setView(view == 'grid' ? 'list' : 'grid')"
        title="{{!view || view == 'grid' ? 'catalogs_grid_view' : 'catalogs_list_view' | translate}}">
        <div ng-show="!view || view === 'grid'">
          <bx-icon class="bx--search__icon" icon="grid"></bx-icon>
        </div>
        <div ng-show="view === 'list'">
          <bx-icon class="bx--search__icon" icon="list"></bx-icon>
        </div>
      </button>
      <div data-overflow-menu class="bx--search__sort bx--overflow-menu" tabindex="0" aria-label="List of options" data-ng-init="toggleFilter = false" data-ng-class="{'bx--overflow-menu--open': toggleFilter}" data-ng-click="toggleFilter = !toggleFilter">
        <bx-icon class="bx--search__icon" icon="filter--glyph"></bx-icon>
        <div class="bx--overflow-menu__options">
          <div class="filter-pane-title displayInline">{{::'catalogs_types' | translate}}:</div>
          <div class="typeCheck">
            <bx-checkbox
              data-ng-model="typeFilterStates.catalog"
              bx-prevent-default="true">
              {{::'catalogs_type_catalog' | translate}}
            </bx-checkbox>
          </div>
          <div class="typeCheck">
            <bx-checkbox
              data-ng-model="typeFilterStates.app"
              bx-prevent-default="true">
              {{::'catalogs_type_app' | translate}}
            </bx-checkbox>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="stickyNote" data-ng-show="environments.length == 0 && !fetchingData">{{::'catalogs_no_permission' | translate}}</div>
  <div data-ng-class="{'spinner': !environments || fetchingData}"></div>
  <div data-ng-class="{expanded: panelExpanded}" data-ng-show="environments && !fetchingData">
    <div data-ng-if="(!view || view == 'grid')">
      <div class="catalogsEnvironments listingColumn tabularData secondaryBackground underMainBanner">
        <div data-ng-repeat="entity in entities = (allData | filter:{title:query} | entityType:typeFilterStates | orderBy:'createdAt':'reverse')" class="dijitInline catalogItem itsAllRelative">
          <bx-cards entity="entity" catalog-image="{{getCatalogImage(entity)}}" perm="permissions['org_catalogs/manage']" link="showEntityURL(entity)" on-delete="confirmDeleteEntity(entity)" fav="setFavourite(entity.type, entity)" isfav="isFavourite(entity.type, entity)"></bx-cards>
        </div>
      </div>
    </div>
    <div class="bxTableDashBoard" data-ng-if="view == 'list'">
      <div class="bx--responsive-table-container">
        <table class="bx--responsive-table">
          <thead class="bx--table-head tableHeaderBackground bxTableHeader">
            <tr class="bx--table-row">

              <th class="bx--table-header bxTablePaddingLeft"></th>
              <th class="bx--table-header">{{::'catalog_title' | translate}}</th>
              <th class="bx--table-header">{{::'sortByCreateDateColumn' | translate}}</th>
              <th class="bx--table-header">{{::'catalog_type' | translate}}</th>
              <th class="bx--table-header bxTablePaddingRight">{{::'catalog_actions' | translate}}</th>

            </tr>
          </thead>
          <tbody class="bx--table-body">

            <tr class="bx--table-row bx--parent-row" ng-class-even="'bx--parent-row--even'" data-ng-repeat="entity in entities = (allData | filter:{title:query} | entityType:typeFilterStates | orderBy:'createdAt':'reverse')">

              <td class="bxTablePaddingLeft"><img class="thumbnailImage" data-ng-attr-src="apim/images/catalogs/{{getCatalogImage(entity)}}.png" aria-hidden="true" alt="" /></td>
              <td class="fullWidth">
                <a data-ng-bind-html="entity.title | highlight: query" href="#/catalogs/{{entity.type == 'catalog' ? (entity.id + '/initial') : ('apps/' + entity.id)}}"></a>
              </td>
              <td>{{entity.createdAt | dateformat:'L LT'}}</td>
              <td>{{typeNameMap[entity.type]}}</td>
              <td class="alignRight bxTablePaddingRight">
                <button class="iconOnlyButton catalogURL material-icons" data-ng-click="showEntityURL(entity)" title="{{entity.type == 'catalog' ? ('catalogs_show_catalog_url' | translate) : ('catalogs_show_app_url' | translate)}}">link</button>
                <button title="{{::'addToFavouritesSpecific2' | translate:entity}}" class="iconOnlyButton material-icons notFavouriteIcon" data-ng-click="setFavourite(entity.type, entity)" data-ng-show="!isFavourite(entity.type, entity)" aria-label="{{::'addToFavouritesSpecific2' | translate:entity}}"
                ng-if="!offlineMode">star</button>
                <button style="margin-left: 0px;" title="{{::'removeFromFavouritesSpecific2' | translate:entity}}" class="iconOnlyButton material-icons favouriteIcon" data-ng-click="setFavourite(entity.type, entity)" data-ng-show="isFavourite(entity.type, entity)" aria-label="{{::'removeFromFavouritesSpecific2' | translate:entity}}"
                ng-if="!offlineMode">star</button>
                <button data-ng-show="permissions['org_catalogs/manage']" class="iconOnlyButton material-icons" style="vertical-align: top;" title="{{::'delete' | translate}}" data-ng-click="confirmDeleteEntity(entity);">delete</button>
              </td>
            </tr>
          </tbody>
        </table>
        <div data-ng-class="{'spinner': !environments || fetchingData}"></div>
      </div>
    </div>
  </div>
</div>
