<!--
/********************************************************* {COPYRIGHT-TOP} ***
* Licensed Materials - Property of IBM
* 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
*
* (C) Copyright IBM Corporation 2017
*
* All Rights Reserved.
* US Government Users Restricted Rights - Use, duplication or disclosure
* restricted by GSA ADP Schedule Contract with IBM Corp.
********************************************************** {COPYRIGHT-END} **/
-->
<div data-ng-controller="CommunitySubscriptionsController">
  
  <div data-ng-include="'apim/community/partials/community-header.html'"></div>
  <div class="secondaryBackground centerColumn">
    <div class="bx--responsive-table-container">
      <div class="floatRight">
        <pagination style="margin: 0px;" data-ng-show="!loadingSubscriptions && totalItems > pageSize" boundary-links="true" rotate="false" data-ng-change="subscriptionsPageChanged(currentPage)" total-items="totalItems" data-ng-model="currentPage" class="pagination-sm" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;" items-per-page="pageSize" max-size="3"></pagination>
      </div>
      <div class="clearBoth"></div>
      <table class="bx--responsive-table">
        <thead class="bx--table-head">
          <tr class="bx--table-row">

            <th class="bx--table-header bx--table-sort bxTablePaddingLeft" ng-class="{'bx--table-sort--ascending' : orderDirection, 'bx--table-sort-active' : orderProp == '$$productName'}" data-ng-click="orderProp = '$$productName'; orderDirection = !orderDirection;">
              <span>{{::'realProductSingular' | translate}}</span>
              <bx-icon class="bx--table-sort__svg" icon="caret--down"></bx-icon>
            </th>

            <th class="bx--table-header bx--table-sort" ng-class="{'bx--table-sort--ascending' : orderDirection, 'bx--table-sort-active' : orderProp == 'application.appName'}" data-ng-click="orderProp = 'application.appName'; orderDirection = !orderDirection;">
              <span>{{::'application' | translate}}</span>
              <bx-icon class="bx--table-sort__svg" icon="caret--down"></bx-icon>
            </th>

            <th class="bx--table-header bx--table-sort" ng-class="{'bx--table-sort--ascending' : orderDirection, 'bx--table-sort-active' : orderProp == '$$developerOrgName'}" data-ng-click="orderProp = '$$developerOrgName'; orderDirection = !orderDirection;">
              <span>{{::'organization' | translate}}</span>
              <bx-icon class="bx--table-sort__svg" icon="caret--down"></bx-icon>
            </th>

            <th class="bx--table-header bxTablePaddingRight"></th>
          </tr>
        </thead>
        <tbody class="bx--table-body">
          <tr class="bx--table-row bx--parent-row bxTablePaddingLeft" data-ng-show="loadingSubscriptions">
            <td colspan="6"><div class="spinner"></div></td>
          </tr>
          <tr class="bx--table-row bx--parent-row bxTablePaddingLeft" data-ng-show="subscriptions && subscriptions.length === 0 && !loadingSubscriptions">
            <td colspan="5" class="table-empty">{{(spaceId ? 'community-no-subscriptions-space' : 'community-no-subscriptions') | translate}}</td>
          </tr>

          <tr class="bx--table-row bx--parent-row bxTablePaddingLeft" data-ng-show="subscriptions && subscriptions.length > 0 && filteredSubscriptions.length === 0 && !loadingSubscriptions">
            <td colspan="5">{{::'community-no-matching-subscriptions' | translate}}</td>
          </tr>

          <tr class="bx--table-row bx--parent-row" data-ng-show="!loadingSubscriptions" ng-class-even="'bx--parent-row--even'" data-ng-repeat="subscription in filteredSubscriptions = (filterSubscriptions(query) | orderBy: orderProp: orderDirection)" data-ng-controller="CommunitySubscriptionController">
            <td class="bxTablePaddingLeft" data-ng-bind-html="subscription.$$productName | highlight: query"></td>
            <td>
              <span data-ng-bind-html="subscription.application.appName | highlight: query"></span>
              <button style="margin-top: -2px;" class="material-icons iconOnlyButton alignMiddle infoIcon" data-ng-click="showTooltip = !showTooltip;" data-tooltip-is-open="showTooltip" data-tooltip-html-unsafe="{{subscription.application.clientId | highlight: query}}" data-tooltip-placement="right">info_outline</button>
            </td>

            <td data-ng-bind-html="subscription.$$developerOrgName | highlight: query"></td>

            <td class="bx--table-overflow fixed-overflow bxTablePaddingRight">

                <bx-overflow-menu data-ng-show="permissions[spaceId ? spaceId + '/space_planSubscriptions/manage' : environment.id + '/catalog_planSubscriptions/manage']">

                  <bx-overflow-menu-item item-text="{{::'ttManage' | translate}}" data-ng-click="migrateSubscription();">
                  </bx-overflow-menu-item>

                  <bx-overflow-menu-item item-text="{{::'community-show-developer-org' | translate}}" data-ng-click="openView(1, subscription.$$developerOrgName)">
                  </bx-overflow-menu-item>

                  <bx-overflow-menu-item item-text="{{::'community-show-application' | translate}}" data-ng-click="openView(3, subscription.application.clientId)">
                  </bx-overflow-menu-item>

                  <bx-overflow-menu-item item-text="{{::'removeSubscription' | translate}}" data-ng-click="deleteSubscription();" warn-user="true">
                  </bx-overflow-menu-item>

                </bx-overflow-menu>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
