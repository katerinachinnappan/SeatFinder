/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2016, 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apim-ui

'use strict';

angular.module('apim.users')
  .service('currentUsersServices', ['$window','$localStorage', 'NpsLanguages', function ($window, $localStorage, NpsLanguages) {
    this.getDaysSinceFirstLogin = function(userId) {
      if (!$localStorage.getItem(userId)) {
        var firstLoginInDate = new Date();
        $localStorage.setItem('first_login_' + userId, firstLoginInDate);
      }

			var curretDate = new Date();
			var timeDiffSinceFirstLogin = Math.abs( new Date($localStorage.getItem('first_login_' +   userId)).getTime() - curretDate.getTime());
			return Math.ceil(timeDiffSinceFirstLogin / (1000 * 3600 * 24));
		};

    this.getUsersLanguage = function() {
      var language = getBrowsersLanguage().toLowerCase();
      if (language in NpsLanguages) {
        language = NpsLanguages[language];
      }
			return language;
    };

    function getBrowsersLanguage() {
      var nav = $window.navigator || false;
      var language = nav.languages && nav.languages[0] // Chrome / Firefox
        || nav.language // All browsers
        || nav.userLanguage || nav.browserLanguage || nav.systemLanguage // IE <= 10
        || 'en-us'; // default value
      return language;
    };}]
  );
