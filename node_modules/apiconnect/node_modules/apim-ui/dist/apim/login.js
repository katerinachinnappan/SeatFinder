/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2015, 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apim-ui

  /* global networkMode */
'use strict';

angular.module('apim.login', [
  'apim.errors',
  'ui.validate',
  'apim.common',
  'apim.templates',
  'pascalprecht.translate',
  'ngMaterial',
  'ngAnimate',
  'ngResource',
  'ngSanitize',
  'ui.bootstrap',
  'localization'
])
  .run(['$rootScope', '$mdDialog', '$http', '$modal', function($rootScope, $mdDialog, $http, $modal) {

    $rootScope.offlineMode = networkMode === 'offline';

    $rootScope.$on('event:showError', function(event, error, reload) {
      var scope = $rootScope.$new(true);
      scope.errorInfo = {
        titleKey: 'error',
        error: error,
        okPressed: function() {
          if (reload == true) {
            window.location.reload();
          }
        }
      };
      $modal.open({
        templateUrl: 'apim/partials/error-message.html',
        windowTemplateUrl: 'apim/partials/main-template.html',
        controller: 'ErrorMessageController',
        scope: scope,
        backdrop: 'static'
      });
    });
  }])
  .config(['$httpProvider', function($httpProvider) {
    $httpProvider.interceptors.push(['errorHandler', function(errorHandler) {
      return {
        'response': function(response) {
          return errorHandler.checkResponse(response);
        },
        'responseError': function(rejection) {
          return errorHandler.checkResponse(rejection);
        }
      };
    }]);
  }]);

$(function () {
  angular.bootstrap(window.document, ['apim.login']);
});

