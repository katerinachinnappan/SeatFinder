<!--
/********************************************************* {COPYRIGHT-TOP} ***
* Licensed Materials - Property of IBM
* 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
*
* (C) Copyright IBM Corporation 2017
*
* All Rights Reserved.
* US Government Users Restricted Rights - Use, duplication or disclosure
* restricted by GSA ADP Schedule Contract with IBM Corp.
********************************************************** {COPYRIGHT-END} **/
-->
<div class="environmentDetails underMainBanner" apic-save-key="checkConfigAndSave()" data-ng-controller="EnvironmentCtrl as environmentController">
	<div class="ng-hide" data-ng-show="!environment && envChecked">
		<div class="stickyNote">{{::'catalog_not_exist' | translate}}</div>
	</div>
	<div class="bannerActions layout" data-ng-show="!xhrProcessing">
    <button aria-label="{{::'save' | translate}}" title="{{::'save' | translate}}" type="submit" class="highVisButton iconOnlyButton material-icons" data-ng-click="checkConfigAndSave()" data-ng-disabled="environmentForm.$invalid || saveDisabled" data-ng-show="(permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || permissions[spaceId + '/space_spaceSettings/manage']) && environment && !fetchingCollectives">save</button>
	</div>
	<div data-ng-class="{'spinner':!environments || fetchingCollectives}"></div>
	<div data-ng-show="environment && !fetchingCollectives">
    <form name="environmentForm">
			<div class="stretch underMainBanner" data-ng-init="tab = 1">
				<div class="toc stretch">
					<ul>
						<li class="tocItem"><a data-ng-click="tab = 1" data-ng-class="{selected: tab == 1}">{{::'env_info' | translate}}</a></li>
            <li class="tocItem"><a data-ng-click="tab = 6" data-ng-class="{selected: tab == 6}">{{::'env_approvals' | translate}}</a></li>
						<li class="tocItem"><a data-ng-click="tab = 2" data-ng-class="{selected: tab == 2}">{{::'env_gateways' | translate}}</a></li>
						<li class="tocItem" data-ng-if="features.multipleGatewayCatalogs" ><a data-ng-click="$parent.tab = 2" data-ng-class="{selected: tab == 2}">{{::'env_policies_and_extensions' | translate}}</a></li>
						<li class="tocItem"><a data-ng-click="tab = 4" data-ng-class="{selected: tab == 4}">{{::'env_portal' | translate}}</a></li>
            <li class="tocItem"><a data-ng-click="tab = 5" data-ng-class="{selected: tab == 5}">{{::'env_roles' | translate}}</a></li>
            <li class="tocItem" data-ng-if="features.customPolicies && !features.multipleGatewayCatalogs && !isSaaS"><a data-ng-click="$parent.tab = 7" data-ng-class="{selected: tab == 7}">{{::'env_policies' | translate}}</a></li>
            <li class="tocItem" data-ng-if="features.vendorExtensions && !features.multipleGatewayCatalogs"><a data-ng-click="$parent.tab = 8" data-ng-class="{selected: tab == 8}">{{::'env_extensions' | translate}}</a></li>
            <li class="tocItem" data-ng-if="spaceStateEnabled"><a data-ng-click="$parent.tab = 9" data-ng-class="{selected: tab == 9}">{{::'env_spaces' | translate}}</a></li>
					</ul>
				</div>
				<section data-ng-if="tab == 1" class="stretch contentWithToc">
					<div class="mediumPadding">
						<div class="bx--form__fieldset">
							<div class="bx--form__legend">{{::'env_info' | translate}}</div>
							<bx-input-container>
							  <label>{{::'displayName' | translate}}</label>
							  <input type="text" data-ng-model="selectedEnvironment.name" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" apim-auto-focus />
							</bx-input-container>
							<bx-input-container>
							  <label>{{::'name' | translate}}</label>
							  <input type="text" data-ng-pattern="catalogNameRegEx" data-ng-model="selectedEnvironment.shortName" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" />
							</bx-input-container>
						<div class="webapiFormRow topExtraMargin">
							<md-switch class="md-primary" data-md-no-ink data-ng-model="selectedEnvironment.autoDeploy" data-ng-change="sandboxChanged()" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" aria-label="{{::'isForcePublish' | translate}}"> {{::'isForcePublish' | translate}} </md-switch>
							<div class="stickyNote" data-ng-show="showSandboxWarning">{{::'sandboxWarning' | translate}}</div>
							<p class="switchIndent">{{::'sandboxDescription' | translate}}</p>
						</div>
            <div class="bx--form__row-item">
              <md-switch class="md-primary" data-md-no-ink data-ng-model="selectedEnvironment.testAppEnabled" data-ng-disabled="!selectedEnvironment.autoDeploy || !permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" aria-label="{{::'catalogTestAppLabel' | translate}}"> {{::'catalogTestAppLabel' | translate}} </md-switch>
              <p class="switchIndent">{{::'catalogTestAppDescription' | translate}}</p>
            </div>
						<div class="stickyNote" data-ng-show="selectedEnvironment.testAppEnabled && !selectedEnvironment.testAppCredentials">{{::'catalogTestAppGenerate' | translate}}</div>
						<div class="bx--form__row-item indentedRow" data-ng-if="selectedEnvironment.testAppEnabled && selectedEnvironment.testAppCredentials">
							<bx-input-container data-ng-if="!showClientId">
							  <label>{{::'clientId' | translate}}</label>
							  <input type="password" data-ng-model="selectedEnvironment.testAppCredentials.clientId" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" />
							</bx-input-container>
							<button class="bx--btn bx--btn--sm" data-ng-if="!showClientId" data-ng-click="$parent.showClientId = !$parent.showClientId">{{::'clientIdShow' | translate}}</button>
							<bx-input-container data-ng-if="showClientId">
							  <label>{{::'clientId' | translate}}</label>
							  <input md-select-on-focus type="text" data-ng-model="selectedEnvironment.testAppCredentials.clientId" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" />
							</bx-input-container>
							<button class="bx--btn bx--btn--sm" data-ng-if="showClientId" data-ng-click="$parent.showClientId = !$parent.showClientId">{{::'clientIdHide' | translate}}</button>
            </div>
						<div class="bx--form__row-item indentedRow" data-ng-if="selectedEnvironment.testAppEnabled && selectedEnvironment.testAppCredentials">
							<bx-input-container data-ng-if="!showClientSecret">
							  <label>{{::'clientSecret' | translate}}</label>
							  <input type="password" data-ng-model="selectedEnvironment.testAppCredentials.clientSecret" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" />
							</bx-input-container>
							<button class="bx--btn bx--btn--sm" data-ng-if="!showClientSecret" data-ng-click="$parent.showClientSecret = !$parent.showClientSecret">{{::'clientIdShow' | translate}}</button>
							<bx-input-container class="flex-50" data-ng-if="showClientSecret">
							  <label>{{::'clientSecret' | translate}}</label>
							  <input md-select-on-focus type="text" data-ng-model="selectedEnvironment.testAppCredentials.clientSecret" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" />
							</bx-input-container>
							<button class="bx--btn bx--btn--sm" data-ng-if="showClientSecret" data-ng-click="$parent.showClientSecret = !$parent.showClientSecret">{{::'clientIdHide' | translate}}</button>
						</div>
            <div class="webapiFormRow topMargin" data-ng-show="!selectedEnvironment.gatewayType || selectedEnvironment.gatewayType == 'DataPowerGateway'">
              <md-switch class="md-primary" data-md-no-ink data-ng-model="selectedEnvironment.default" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" aria-label="{{::'isDefaultEnvironment' | translate}}"> {{::'isDefaultEnvironment' | translate}} </md-switch>
              <p class="switchIndent">{{::'defaultStagingDescription' | translate}}</p>
            </div>
            <div class="webapiFormRow topMargin" data-ng-if="features.spaces">
              <md-switch class="md-primary" data-md-no-ink data-ng-model="$spaceEnabled" data-ng-model-options="{getterSetter:true}" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" aria-label="{{::'isDefaultEnvironment' | translate}}"> {{::'env_spaces_checkbox' | translate}} </md-switch>
              <p class="switchIndent">{{::'env_spaces_description' | translate}}</p>
              <div class="switchIndent" data-ng-show="spaceStateEnabled"><a href="" data-ng-click="$parent.$parent.tab = 9">{{::'env_manage_spaces' | translate}}</a></div>
            </div>
					</div>
					<div class="bx--form__fieldset">
						<div class="bx--form__legend">{{::'catalogs_unenforced_endpoint' | translate}}</div>
						<div class="webapiFormRow layout topMargin">
							<bx-input-container>
								<label>{{::'customThirdPartyAPIGatewayURL' | translate}}</label>
								<input type="url" data-ng-model="selectedEnvironment.customApiUrl" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" />
							</bx-input-container>
						</div>
					</div>
					</div>
				</section>
        <section data-ng-if="tab == 2" class="stretch contentWithToc">
					<div>
          	<div class="mediumPadding">
							<div class="webapiFormRow">
								<div class="bx--form__legend">{{::'gatewayServiceOrCollective' | translate}}</div>
								<button class="bx--btn"
									data-ng-click="configureGateway()"
									data-ng-show="permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] && !spaceId && !isSaaS">{{::'gatewayConfigure' | translate}}</button>
								<div class="topMargin" data-ng-if="!selectedEnvironment.gatewayType || selectedEnvironment.gatewayType == 'DataPowerGateway'">
									<md-switch data-ng-show="spaceId" style="padding-left: 18px;" class="md-primary" data-md-no-ink data-ng-model="$overrideGatewayServices" data-ng-model-options="{'getterSetter': true}" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage']" aria-label="{{::'gatewayOverrideServices' | translate}}">{{::'gatewayOverrideServices' | translate}}</md-switch>
									<div class="tableHeaderBackground bxTableHeader">
										<div class="cloumn gatewaySelectColumn" data-ng-show="spaceId && spacesCache[spaceId].gwServices"></div><div
												 class="column gatewayServiceColumn">{{::'catalogs_gateway_services_column' | translate}}</div><div
												 class="column gatewayEndpointColumn">{{::'catalogs_gateway_endpoint_column' | translate}}</div>
									</div>
									<div class="cleanTableBody">
										<div class="cleanTableRow" data-ng-repeat="gwService in selectedEnvironment.gwServices" data-ng-controller="CatalogSpaceGatewayController">
											<div data-ng-show="spacesCache[spaceId].gwServices" class="column gatewaySelectColumn">
												<md-switch style="margin-top: 3px;" class="md-primary" data-md-no-ink data-ng-model="$selectGatewayServiceForSpace" data-ng-model-options="{'getterSetter': true}" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage']" aria-label="{{::'gatewaySelectServiceForSpace' | translate}}"></md-switch>
											</div><div class="column gatewayServiceColumn">
												<span>{{gwService.$$name}}</span>
												<span class="tag--beta appLifecycleTag" ng-class="'appLifecycle-'+type" data-ng-repeat="type in gwService.$$type">{{type | applicationType}}</span>
											</div><div class="column gatewayEndpointColumn">
												<bx-input-container style="margin: 10px 0;">
                          <input type="text" aria-label="{{'catalogs_gateway_endpoint_column' | translate}}'" placeholder="{{'catalogs_gateway_endpoint_column' | translate}}" data-ng-model="gwService.endpointUrl" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" data-ng-model-options="{'updateOn': 'blur'}">
												</bx-input-container>
												<bx-input-container style="margin: 10px 0;">
                          <input type="text" aria-label="{{'endpoints_description' | translate}}" placeholder="{{'endpoints_description' | translate}}" data-ng-model="gwService.description" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId">
												</bx-input-container>
											</div>
										</div>
									</div>
								</div>
								<div class="mediumPadding greyBoxBorderTopBottom topMargin" data-ng-if="selectedEnvironment.gatewayType == 'MicroGateway'">
									<div>{{::'gatewayCollectiveName' | translate}} <span class="bold">{{collectivesLookup[selectedEnvironment.microGateway.collectiveId].title}}</span></div>
									<div>{{::'gatewayApplicationName' | translate}} <span class="bold">{{appsLookup[selectedEnvironment.microGateway.applicationId].name}}</span></div>
									<div class="webapiFormRow layout">
										<md-input-container class="flex-100">
											<label>{{::'customAPIGatewayURL' | translate}}</label>
											<input type="url" data-ng-model="selectedEnvironment.customBaseUrl" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" data-ng-required="selectedEnvironment.gatewayType == 'MicroGateway'"/>
										</md-input-container>
									</div>
								</div>
								<div class="mediumPadding greyBoxBorderTopBottom topMargin" data-ng-if="selectedEnvironment.gatewayType == 'StandaloneMicroGateway'">
									<div>{{::'gatewayApiconnectStandaloneMicroGateway' | translate}} <a href="" data-ng-click="populateDownloadConfigURL();" class="bold" style="margin-left: 10px">{{'downloadConfigFile' | translate}}</a></div>
									<div class="webapiFormRow layout">
										<md-input-container class="flex-100">
											<label>{{::'customAPIGatewayURL' | translate}}</label>
											<input type="url" data-ng-model="selectedEnvironment.customBaseUrl" data-ng-disabled="!permissions[selectedEnvironment.id + '/catalog_catalogSettings/manage'] || spaceId" data-ng-required="selectedEnvironment.gatewayType == 'MicroGateway'"/>
										</md-input-container>
									</div>
								</div>
								<iframe style="display: none;" ng-src="{{downloadConfigURL}}" title="{{::'apiDownloadFrameTitle' | translate}}"></iframe>
							</div>
						</div>
					</div>
					<div data-ng-if="features.multipleGatewayCatalogs">
						<apim-catalog-gateways></apim-catalog-gateways>
					</div>
        </section>
        <section data-ng-if="tab == 4" class="stretch contentWithToc">
          <apim-environment-portal></apim-environment-portal>
        </section>
        <section data-ng-if="tab == 5" class="stretch contentWithToc">
					<div>
					  <apim-environment-roles></apim-environment-roles>
					</div>
				</section>
        <section data-ng-if="tab == 6" class="stretch contentWithToc">
          <div class="mediumPadding">
            <apim-environment-approvals></apim-environment-approvals>
          </div>
        </section>
        <section data-ng-if="tab == 7" class="stretch contentWithToc" data-ng-if="features.customPolicies">
          <div class="mediumPadding">
            <apim-environment-policies></apim-environment-policies>
          </div>
				</section>
        <section data-ng-if="tab == 8" class="stretch contentWithToc" data-ng-if="features.vendorExtensions">
          <div class="mediumPadding">
            <apim-environment-vendor-extensions></apim-environment-vendor-extensions>
          </div>
				</section>
        <section data-ng-if="tab == 9" class="stretch contentWithToc">
          <div>
            <apim-environment-spaces></apim-environment-spaces>
          </div>
        </section>
			</div>
		</form>
	</div>
</div>
