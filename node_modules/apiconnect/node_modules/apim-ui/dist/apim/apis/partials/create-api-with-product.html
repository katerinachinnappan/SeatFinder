<!--
/********************************************************* {COPYRIGHT-TOP} ***
* Licensed Materials - Property of IBM
* 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
*
* (C) Copyright IBM Corporation 2017
*
* All Rights Reserved.
* US Government Users Restricted Rights - Use, duplication or disclosure
* restricted by GSA ADP Schedule Contract with IBM Corp.
********************************************************** {COPYRIGHT-END} **/
-->
<h2 class="bx--modal-content__heading" role="banner" aria-label="{{::createDialogTitle | translate}}">{{::createDialogTitle | translate}}
</h2>
<button title="Close" class="bx--modal__close" type="button" data-ng-click="cancel();" tabindex="-1">
  <bx-icon class="bx--modal__close--icon" icon="close"></bx-icon>
</button>
<div class="bx--modal-content" data-ng-switch="currentPage">
	<div class="detailsSection" data-ng-switch-default>
		<form data-ng-submit="validateAndCreate()" name="$parent.newApiForm">
			<button type="submit" style="display: none;">{{::'submitText' | translate}}</button>
			<div class="bx--form__legend">{{::'api_info' | translate}}</div>
			<div class="bx--form__fieldset">
				<bx-input-container>
					<label>{{::'apiShortName' | translate}}</label>
					<input apim-auto-focus title="{{::'apiShortName' | translate}}" required data-ng-model="newApi.title" autofocus/>
				</bx-input-container>
				<bx-input-container>
					<label>{{::'real_api_name' | translate}}</label>
					<input title="{{::'real_api_name' | translate}}" data-ng-model="newApi.name" required
          data-ng-pattern="/^[A-Za-z0-9_\-]+$/">
				</bx-input-container>
				<bx-input-container>
					<label>{{::'api_base_path' | translate}}</label>
					<input title="{{::'api_base_path' | translate}}" data-ng-model="newApi.basepath" required/>
				</bx-input-container>
				<bx-input-container>
					<label>{{::'apiSwaggerVersion' | translate}}</label>
					<input title="{{::'apiSwaggerVersion' | translate}}" required data-ng-model="newApi.version"/>
				</bx-input-container>
			</div>
			<div data-ng-show="!creatingOAuthProvider" class="hidden-focus" style="margin: 20px 0;" data-ng-click="showAdditionalProperties = !showAdditionalProperties">
				<div class="alignMiddle displayInline" stlye="line-height: 24px;">{{::'api_create_additional_properties' | translate}}</div>
				<div class="alignMiddle displayInline material-icons transition200" data-ng-class="{'rotate180': !showAdditionalProperties}">keyboard_arrow_up</div>
			</div>
			<div data-ng-show="showAdditionalProperties">
				<div class="bx--form__legend">{{::'api_create_template' | translate}}</div>
        <bx-input-container>
          <div class="bx--select labeledSelect">
            <label class="bx--form__label">{{::'api_create_template_label' | translate}}</label>
            <select class="productPlanSelector bx--select__input"  data-ng-model="$parent.apiTemplate">
              <option value="__default_api__">{{::'api_create_template_default' | translate}}</option>
              <option value="oauth2">{{::'api_create_template_oauth2' | translate}}</option>
              <option data-ng-repeat="(templateName, templateString) in customApiTemplates" value="{{templateName}}">{{templateName.split("/").pop()}}</option>

            </select>
            <bx-icon class="bx--select__arrow" icon="caret--down"></bx-icon>
          </div>
        </bx-input-container>
        <div style="display: none;" class="flex40">
          <button style="margin-top: 24px;" class="iconOnlyButton material-icons" data-ng-click="$parent.currentPage = 2;" title="{{::'api_create_template_properties' | translate}}">more_horiz</button>
        </div>
				<div class="bx--form__legend">{{::'api_create_target' | translate}}</div>
        <bx-input-container>
          <label>{{::'api_create_target_label' | translate}}</label>
          <input title="{{::'api_create_target_label' | translate}}" class="marginBottom10 createApiHostname" data-ng-model="newApi.hostname" autofocus/>
        </bx-input-container>
				<div class="bx--form__legend">{{::'api_security' | translate}}</div>
        <bx-input-container>
        <div class="bx--select labeledSelect">
          <label class="bx--form__label">{{::'api_security_identify_using' | translate}}</label>
          <select class="productPlanSelector bx--select__input"  data-ng-model="identifyUsing" data-ng-model-options="{getterSetter: true}">
            <option value="none">{{::'none' | translate}}</option>
            <option value="id">{{::'clientId' | translate}}</option>
            <option value="both">{{::'clientIdAndSecret' | translate}}</option>
          </select>
          <bx-icon class="bx--select__arrow" icon="caret--down"></bx-icon>
        </div>
        </bx-input-container>
        <div class="bx--form__row-item">
          <bx-checkbox aria-label="{{::'api_enable_cors' | translate}}" data-ng-model="newApi.cors" class="flex40">{{::"api_enable_cors" | translate}}</bx-checkbox>
        </div>
				<div class="bx--form__legend">{{::'api_create_gateway' | translate}}</div>
        <bx-input-container>
          <div class="bx--select labeledSelect">
            <select class="productPlanSelector bx--select__input"  data-ng-model="newApi.gateway" aria-label="{{::'api_create_gateway' | translate}}">
              <option value="both">{{::'api_create_gateway_both' | translate}}</option>
              <option value="micro-gateway">{{::'api_create_gateway_mg' | translate}}</option>
              <option value="datapower-gateway">{{::'api_create_gateway_dp' | translate}}</option>
            </select>
            <bx-icon class="bx--select__arrow" icon="caret--down"></bx-icon>
          </div>
        </bx-input-container>
			</div>
		</form>
	</div>
	<div class="detailsSection" data-ng-switch-when="2">
			<div class="bx--form__legend">{{::'api_create_template_properties' | translate}}</div>
			<div class="bx--form__fieldset" data-ng-show="template !== 'oauth2'">
				<div class="flex" data-ng-repeat="(key, value) in additionalProperties" data-ng-controller="TemplatePropertyController">
					<bx-input-container class="flex40">
						<label>{{::'name' | translate}}</label>
						<input title="{{::'name' | translate}}" data-ng-model="propertyKey" data-ng-model-options="{'updateOn': 'change blur', 'getterSetter': true}"/>
						<div data-ng-messages="existingPropertyError">
							<div style="opacity: 1; margin: 0;" data-ng-message="clash">{{::'api_create_template_properties_clash' | translate}}</div>
						</div>
					</bx-input-container>
					<bx-input-container class="flex60">
						<label>{{::'value' | translate}}</label>
						<input title="{{::'value' | translate}}" data-ng-model="additionalProperties[key]"/>
					</bx-input-container>
				</div>
				<div class="flex">
					<bx-input-container class="flex40">
						<label>{{::'name' | translate}}</label>
						<input title="{{::'name' | translate}}" data-ng-model="newPropertyKey" data-ng-model-options="{'updateOn': 'change blur', 'getterSetter': true}" apim-auto-focus autofocus/>
						<div data-ng-messages="newPropertyError">
							<div style="opacity: 1; margin: 0;" data-ng-message="clash">{{::'api_create_template_properties_clash' | translate}}</div>
						</div>
					</bx-input-container>
					<bx-input-container class="flex60">
						<label>{{::'value' | translate}}</label>
						<input title="{{::'value' | translate}}" data-ng-model="newPropertyValue" data-ng-model-options="{'updateOn': 'change blur', 'getterSetter': true}"/>
					</bx-input-container>
				</div>
			</div>
	</div>
	<div class="detailsSection" data-ng-switch-when="3">
		<div data-ng-include="'apim/products/partials/create-product-template.html'"></div>
	</div>
	<div data-ng-class="{'spinner': creatingApi}"></div>
</div>
<div class="bx--modal__buttons" role="contentinfo" aria-label="{{'footerSectionLabel' | translate}}">
  <div class="bx--modal__buttons-container">
    <button class="bx--btn--secondary no-animate" type="button" data-ng-click="cancel();" data-ng-show="currentPage !== 2" data-ng-disabled="creatingApi">{{::'cancel' | translate}}</button>
    <button class="bx--btn--secondary no-animate" type="button" data-ng-click="cancelProperties();" data-ng-show="currentPage === 2">{{::'cancel' | translate}}</button>
    <button class="bx--btn no-animate" type="button" data-ng-click="saveProperties();" data-ng-show="currentPage === 2">{{::'save' | translate}}</button>
    <button class="bx--btn--secondary floatLeft no-animate" type="button" data-ng-click="back();" data-ng-show="currentPage === 3">{{::'back' | translate}}</button>
    <button class="bx--btn--secondary no-animate" type="button" data-ng-click="next();" data-ng-disabled="!newApiForm.$valid || creatingApi" data-ng-show="currentPage === 1 && (offlineMode || environments.length > 0)">{{::'api_create_add_api_to_product' | translate}}</button>
    <button class="bx--btn" type="button" data-ng-disabled="!newApiForm.$valid || (currentPage === 3 && !productFormValid()) || creatingApi" data-ng-click="create();">{{::'api_create_label' | translate}}</button>
  </div>
</div>
