<!--
/********************************************************* {COPYRIGHT-TOP} ***
* Licensed Materials - Property of IBM
* 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
*
* (C) Copyright IBM Corporation 2017
*
* All Rights Reserved.
* US Government Users Restricted Rights - Use, duplication or disclosure
* restricted by GSA ADP Schedule Contract with IBM Corp.
********************************************************** {COPYRIGHT-END} **/
-->
<h2 class="bx--modal-content__heading" role="banner" aria-labelledby="{{$id}}_bannerHeading">{{(wsdlDialogMode == 'inline' ? 'api_inline_wsdl' : 'api_compose_wsdl') | translate}}
</h2>
<button title="Close" class="bx--modal__close" type="button" data-ng-click="cancel();" tabindex="-1">
  <bx-icon class="bx--modal__close--icon" icon="close"></bx-icon>
</button>
<div class="bx--modal-content importDialog" data-ng-switch="currentPage" data-ng-class="{fileMode: fileMode}">
	<form name="wsdlImportForm" data-ng-class="{scrollList: currentPage == 1}">
		<input type="password" style="display: none;" name="foilautofill" aria-hidden="true" title="nodisplay"/>
		<div class="uploadChoice fileChoice no-animate" data-ng-show="currentPage == 1 || (currentPage == 3 && !fromUrl && !fromDiscover)">
			<div class="no-animate" data-ng-show="!fileMode">{{::'api_upload_file' | translate}}</div>
			<apim-file-selector property="wsdlFilename" selected-files="data.wsdlFiles" chosen="data.wsdlChosen" show-as-icon="true"></apim-file-selector>
		</div>
		<div data-ng-switch-default>
			<div class="uploadChoice">
				<div>{{::'api_load_url' | translate}}</div>
				<button class="iconOnlyButton material-icons" data-ng-click="$parent.fromUrl = true; $parent.fromDiscover = false; $parent.currentPage = 2" aria-label="{{::'api_load_url' | translate}}">link</button>
			</div>
			<div class="uploadChoice no-animate" data-ng-show="!offlineMode" data-ng-repeat="registry in registryList track by registry.uuid">
				<div>{{registry.name}}</div>
				<button class="iconOnlyButton material-icons" data-ng-click="selectedRegistry(registry.uuid)" data-ng-disabled="deletingRegistry" aria-label="{{::'importFindRegistrySpecific' | translate:registry}}">room_service</button>
				<button class="iconOnlyButton deleteRegistry" data-ng-click="deleteRegistry(registry)" data-ng-disabled="deletingRegistry" title="{{::'importDeleteRegistry' | translate}}" aria-label="{{::'importDeleteRegistrySpecific' | translate:registry}}"><span class="material-icons">delete</span></button>
			</div>
			<div class="uploadChoice no-animate" data-ng-show="!offlineMode">
				<div>{{::'importFindRegistry' | translate}}</div>
				<button class="iconOnlyButton material-icons" data-ng-click="selectedRegistry('')" aria-label="{{::'importFindRegistry' | translate}}">room_service</button>
			</div>
			<div class="uploadChoice" data-ng-if="existingWSDLs && existingWSDLs.length > 0">
				<div>{{::'usePreviousWsdl' | translate}}</div>
				<button class="textOnlyButton" data-ng-repeat="wsdl in existingWSDLs" data-ng-click="selectedWSDL(wsdl)" aria-label="{{::wsdl.name}}">{{wsdl.name}}</button>
			</div>
			<div class="loadingAnimation38" data-ng-show="!offlineMode && fetchingRegistries"></div>
		</div>
		<div data-ng-switch-when="2">
			<div class="no-animate" data-ng-show="fromUrl">
				<div class="layout topMargin">
					<bx-input-container>
						<label data-ng-class="{'bx--form__label-required': currentPage == 2 && fromUrl}">{{::'importWSDLUrl' | translate}}</label>
						<input type="text" data-ng-model="data.url.url" data-ng-required="currentPage == 2 && fromUrl" apim-auto-focus/>
					</bx-input-container>
				</div>
				<div class="layout topMargin">
					<bx-input-container class="flex-50 margin-right-10">
						<label>{{::'username' | translate}}</label>
						<input type="text" data-ng-model="data.url.username"/>
					</bx-input-container>
					<bx-input-container class="flex-50">
						<label>{{::'password' | translate}}</label>
						<input type="password" data-ng-model="data.url.password"/>
					</bx-input-container>
				</div>
			</div>
			<div class="no-animate" data-ng-show="fromDiscover">
				<div class="layout topMargin">
					<bx-input-container>
						<label data-ng-class="{'bx--form__label-required': currentPage == 2 && fromDiscover}">{{::'importName' | translate}}</label>
						<input type="text" data-ng-model="data.discover.name" data-ng-required="currentPage == 2 && fromDiscover" apim-auto-focus/>
					</bx-input-container>
				</div>
				<div class="layout topMargin">
					<bx-input-container>
						<div class="bx--select labeledSelect">
							<label for="{{$id}}_regType">{{::'importRegistryType' | translate}}</label>
							<select class="bx--select__input" id="{{$id}}_regType" data-ng-model="data.discover.type" data-ng-options="reg.value as reg.name for reg in registryTypes"></select>
							<bx-icon class="bx--select__arrow" icon="caret--down"></bx-icon>
						</div>
					</bx-input-container>
				</div>
				<div class="layout topMargin">
					<bx-input-container class="flex-20 margin-right-10">
						<div class="bx--select labeledSelect">
							<label for="{{$id}}_regProtocol">{{::'importProtocol' | translate}}</label>
							<select class="bx--select__input" id="{{$id}}_regProtocol" data-ng-model="data.discover.protocol" data-ng-options="prot.value as prot.name for prot in protocolTypes"></select>
							<bx-icon class="bx--select__arrow" icon="caret--down"></bx-icon>
						</div>
					</bx-input-container>
					<bx-input-container class="flex-60 margin-right-10">
						<label data-ng-class="{'bx--form__label-required': currentPage == 2 && fromDiscover}">{{::'importHostname' | translate}}</label>
						<input type="text" data-ng-model="data.discover.hostname" data-ng-required="currentPage == 2 && fromDiscover"/>
					</bx-input-container>
					<bx-input-container class="flex-20">
						<label data-ng-class="{'bx--form__label-required': currentPage == 2 && fromDiscover}">{{::'importPort' | translate}}</label>
						<input type="text" data-ng-model="data.discover.port" data-ng-pattern="/^[\d]+$/" data-ui-validate="'validatePort($value)'" data-ng-required="currentPage == 2 && fromDiscover"/>
					</bx-input-container>
				</div>
				<div class="layout">
					<bx-input-container class="flex-100">
						<label>{{data.discover.type == 'wsrr' ? ('importContextRootPrefix' | translate) : ('importContextRoot' | translate)}}</label>
						<input type="text" data-ng-model="data.discover.contextRoot"/>
					</bx-input-container>
				</div>
				<div class="layout topMargin">
					<bx-input-container class="flex-50 margin-right-10">
						<label>{{::'username' | translate}}</label>
						<input type="text" data-ng-model="data.discover.username" />
					</bx-input-container>
					<bx-input-container class="flex-50">
						<label>{{::'password' | translate}}</label>
						<input type="password" data-ng-model="data.discover.password" />
					</bx-input-container>
				</div>
			</div>
		</div>
		<div data-ng-switch-when="3">
      <div data-search-with-options class="displayInline itsAllRelative flex bx--search bx--search-with-options" role="search" data-ng-show="fromDiscover && registryListLookup[currentRegistry].type == 'wsrr'">
      <bx-icon class="bx--search__icon--magnifier" icon="search"></bx-icon>
        <label for="search-with-options__input" class="bx--search__label">Search</label>
        <input type="search" class="bx--search__input" id="search-with-options__input" type="search" aria-label="{{::'importSearch' | translate}}" placeholder="{{::'importSearch' | translate}}" data-ng-model="data.discover.queryString" data-ng-model-options="{debounce:500}" apim-auto-focus>
        <button type="reset" class="iconOnlyButton" data-ng-click="data.discover.queryString = ''" data-ng-show="data.discover.queryString" title="{{::'resetFilter' | translate}}">
          <div class="closeIcon"></div>
        </button>
        <button class="bx--search__sort" type="button" title="{{::'importShowHideFilters' | translate}}" data-ng-click="toggleFilterPanel()">
          <div class="bx--search__toggle-layout__container" data-ng-class="{'filtered': $parent.filterVisible}">
            <bx-icon class="bx--search__icon" icon="filter--glyph"></bx-icon>
          </div>
        </button>
      </div>
			<div class="registryFilter no-animate" data-ng-show="fromDiscover && $parent.filterVisible && !fetchingFilters">
				<div class="filterSection">
					<h5>{{::'importServiceVersionFilters' | translate}}</h5>
					<div class="filterSectionRow">
						<div class="displayInline filterCategory">{{::'importGovernanceStates' | translate}}
						</div><div class="displayInline filtersApplied">
							<ul class="displayInline">
								<li class="appliedFilter" data-ng-repeat="filter in registryListLookup[currentRegistry].filterData.serviceSpecificFilterElements['Governance States'] | discoverSelected">
									{{filter.name}}
									<div title="{{::'importRemoveFilter' | translate}}" aria-label="{{::'importRemoveFilterSpecific' | translate:filter}}" data-ng-click="filter.selected = false" class="closeIcon clickable displayInline"></div>
								</li>
							</ul><div class="dijitInline dropdown" dropdown data-is-open="filterServiceStateOpen">
								<button class="textOnlyButton dropdown-toggle" dropdown-toggle>+{{::'importFilterButtonText' | translate}}</button>
					        	<ul class="dropdown-menu simpleList" aria-label="{{::'importAddFilter' | translate}}" role="menu" onkeypress="filterServiceStateOpen = true;">
					        		<li role="menuitem" class="tertiaryHighlight clickable" data-ng-click="filter.selected = true" data-ng-repeat="filter in registryListLookup[currentRegistry].filterData.serviceSpecificFilterElements['Governance States'] | discoverNotSelected">{{filter.name}}</li>
								</ul>
							</div>
						</div>
					</div>
					<div class="filterSectionRow">
						<div class="displayInline filterCategory">{{::'importClassifications' | translate}}
						</div><div class="displayInline filtersApplied">
							<ul class="displayInline">
								<li class="appliedFilter" data-ng-repeat="filter in registryListLookup[currentRegistry].flatData.service['Classifications'] | discoverSelected">
									{{filter.entry.name}}
									<div title="{{::'importRemoveFilter' | translate}}" aria-label="{{::'importRemoveFilterSpecific' | translate:filter.entry}}" data-ng-click="filter.entry.selected = false" class="closeIcon clickable displayInline"></div>
								</li>
							</ul><div class="dijitInline dropdown" dropdown data-is-open="filterServiceClassOpen">
								<button class="textOnlyButton dropdown-toggle" dropdown-toggle>+{{::'importFilterButtonText' | translate}}</button>
					        	<ul class="dropdown-menu simpleList" aria-label="{{::'importAddFilter' | translate}}" role="menu" onkeypress="filterServiceClassOpen = true;">
					        		<li role="menuitem" class="tertiaryHighlight clickable indent{{filter.depth}}" data-ng-click="filter.entry.selected = !filter.entry.selected" data-ng-repeat="filter in registryListLookup[currentRegistry].flatData.service['Classifications']"><span class="material-icons">{{filter.entry.selected ? 'check_box' : 'check_box_outline_blank'}}</span>{{filter.entry.name}}</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<div class="filterSection">
					<h5>{{::'importServiceEndpointFilters' | translate}}</h5>
					<div class="filterSectionRow">
						<div class="displayInline filterCategory">{{::'importEnvironments' | translate}}
						</div><div class="displayInline filtersApplied">
							<ul class="displayInline">
								<li class="appliedFilter" data-ng-repeat="filter in registryListLookup[currentRegistry].filterData.endpointSpecificFilterElements['Environments'] | discoverSelected">
									{{filter.name}}
									<div title="{{::'importRemoveFilter' | translate}}" aria-label="{{::'importRemoveFilterSpecific' | translate:filter}}" data-ng-click="filter.selected = false" class="closeIcon clickable displayInline"></div>
								</li>
							</ul><div class="dijitInline dropdown" dropdown data-is-open="filterEndpointEnvironmentOpen">
								<button class="textOnlyButton dropdown-toggle" dropdown-toggle>+{{::'importFilterButtonText' | translate}}</button>
					        	<ul class="dropdown-menu simpleList" aria-label="{{::'importAddFilter' | translate}}" role="menu" onkeypress="filterEndpointEnvironmentOpen = true;">
					        		<li role="menuitem" class="tertiaryHighlight clickable" data-ng-click="filter.selected = true" data-ng-repeat="filter in registryListLookup[currentRegistry].filterData.endpointSpecificFilterElements['Environments'] | discoverNotSelected">{{filter.name}}</li>
								</ul>
							</div>
						</div>
					</div>
					<div class="filterSectionRow">
						<div class="displayInline filterCategory">{{::'importGovernanceStates' | translate}}
						</div><div class="displayInline filtersApplied">
							<ul class="displayInline">
								<li class="appliedFilter" data-ng-repeat="filter in registryListLookup[currentRegistry].filterData.endpointSpecificFilterElements['Governance States'] | discoverSelected">
									{{filter.name}}
									<div title="{{::'importRemoveFilter' | translate}}" aria-label="{{::'importRemoveFilterSpecific' | translate:filter}}" data-ng-click="filter.selected = false" class="closeIcon clickable displayInline"></div>
								</li>
							</ul><div class="dijitInline dropdown" dropdown data-is-open="filterEndpointStateOpen">
								<button class="textOnlyButton dropdown-toggle" dropdown-toggle>+{{::'importFilterButtonText' | translate}}</button>
					        	<ul class="dropdown-menu simpleList" aria-label="{{::'importAddFilter' | translate}}" role="menu" onkeypress="filterEndpointStateOpen = true;">
					        		<li role="menuitem" class="tertiaryHighlight clickable" data-ng-click="filter.selected = true" data-ng-repeat="filter in registryListLookup[currentRegistry].filterData.endpointSpecificFilterElements['Governance States'] | discoverNotSelected">{{filter.name}}</li>
								</ul>
							</div>
						</div>
					</div>
					<div class="filterSectionRow">
						<div class="displayInline filterCategory">{{::'importClassifications' | translate}}
						</div><div class="displayInline filtersApplied">
							<ul class="displayInline">
								<li class="appliedFilter" data-ng-repeat="filter in registryListLookup[currentRegistry].flatData.endpoint['Classifications'] | discoverSelected">
									{{filter.entry.name}}
									<div title="{{::'importRemoveFilter' | translate}}" aria-label="{{::'importRemoveFilterSpecific' | translate:filter.entry}}" data-ng-click="filter.entry.selected = false" class="closeIcon clickable displayInline"></div>
								</li>
							</ul><div class="dijitInline dropdown" dropdown data-is-open="filterEndpointClassOpen">
								<button class="textOnlyButton dropdown-toggle" dropdown-toggle>+{{::'importFilterButtonText' | translate}}</button>
					        	<ul class="dropdown-menu simpleList" aria-label="{{::'importAddFilter' | translate}}" role="menu" onkeypress="filterEndpointClassOpen = true;">
					        		<li role="menuitem" class="tertiaryHighlight clickable indent{{filter.depth}}" data-ng-click="filter.entry.selected = !filter.entry.selected" data-ng-repeat="filter in registryListLookup[currentRegistry].flatData.endpoint['Classifications']"><span class="material-icons">{{filter.entry.selected ? 'check_box' : 'check_box_outline_blank'}}</span>{{filter.entry.name}}</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<div class="filterButtons">
					<button class="bx--btn--secondary" data-ng-click="resetFilter()" data-ng-disabled="savingFilter">{{::'importReset' | translate}}</button>
					<button class="bx--btn" data-ng-click="applyFilter()" data-ng-disabled="savingFilter">{{::'importApply' | translate}}</button>
				</div>
			</div>
			<div class="no-animate" data-ng-class="{'spinner':importingApi || runningQuery || fetchingFilters || savingFilter}" data-ng-show="importingApi || runningQuery || fetchingFilters || savingFilter"></div>
			<div class="serviceList no-animate" data-ng-class="{discover: fromDiscover}" data-ng-show="data.wsdl.services.length > 0 && !runningQuery && !$parent.filterVisible">
				<p>{{data.wsdl.services.length | translatePlurality:'importServicesFound':'count'}}</p>
        <ul>
          <li data-ng-repeat="service in data.wsdl.services">
            <div class="serviceView">
              <div class="mainRow" data-ng-class="{selected: selectedServices[service.serviceId]}">
                <div class="layout topMargin">
                  <bx-checkbox class="flex" data-ng-model="selectedServices[service.serviceId]" title="{{service.filename}}">{{service.service}}</bx-checkbox>
                  <div class="displayInline">
                    <a href="" data-ng-click="revealOperations[service.serviceId] = !revealOperations[service.serviceId]; $event.stopPropagation()">{{::'importShowOperations' | translate}}</a>
                  </div>
                </div>
                <div class="serviceDescription no-animate" data-ng-show="service.description">{{service.description}}</div>
              </div>
              <div class="operationsRow no-animate" data-ng-show="revealOperations[service.serviceId]">
                <ul>
                  <li data-ng-repeat="operation in service.operations">
                    <div class="operationItem">{{operation.operation}}</div>
                  </li>
                </ul>
              </div>
            </div>
          </li>
        </ul>
      </div>
			<div class="serviceMessage no-animate" data-ng-show="!importingApi && !runningQuery && data.wsdl.services.length == 0">{{::'importNoServicesFound' | translate}}</div>
		</div>
		<div data-ng-switch-when="4">
			<div data-ng-include="'apim/products/partials/create-product-template.html'"></div>
		</div>
	</form>
</div>
<div class="bx--modal__buttons" role="contentinfo" aria-label="{{::'footerSectionLabel' | translate}}">
  <div class="bx--modal__buttons-container">
    <button class="bx--btn--secondary floatLeft no-animate" type="button" data-ng-show="currentPage >= 2" data-ng-disabled="savingAPI || (currentPage == 3 && filterVisible)" data-ng-click="doPrevious()">{{::'importBack' | translate}}</button>
    <div class="loadingAnimate" data-ng-show="savingAPI"></div>
    <button class="no-animate" ng-class="currentPage == 1 ? 'bx--btn' : 'bx--btn--secondary'" type="button" data-ng-disabled="savingAPI" data-ng-click="cancel()">{{::'cancel' | translate}}</button>
    <button class="bx--btn no-animate" type="button" data-ng-if="wsdlDialogMode !== 'inline'" data-ng-show="currentPage > 1 && currentPage < 3" data-ng-disabled="importingApi || (currentPage == 3 && (!isServiceSelected() || filterVisible)) || (currentPage == 2 && !wsdlImportForm.$valid)" data-ng-click="doNext()">{{::'importNext' | translate}}</button>
    <button class="bx--btn--secondary no-animate" type="button" data-ng-if="wsdlDialogMode !== 'inline'" data-ng-click="doNext();" data-ng-show="currentPage === 3" data-ng-disabled="importingApi || savingAPI || (currentPage == 3 && (!isServiceSelected() || filterVisible)) || (currentPage == 2 && !wsdlImportForm.$valid)">{{::'api_create_add_api_to_product' | translate}}</button>
    <button class="bx--btn no-animate" type="button" data-ng-if="wsdlDialogMode == 'inline'" data-ng-show="currentPage > 1 && currentPage < 3" data-ng-disabled="importingApi || savingAPI || (currentPage == 3 && (!isServiceSelected() || filterVisible)) || (currentPage == 2 && !wsdlImportForm.$valid)" data-ng-click="doNext()">{{::'importNext' | translate}}</button>
    <button class="bx--btn no-animate" type="button" data-ng-show="currentPage >= 3" data-ng-disabled="(currentPage == 2 && !wsdlImportForm.$valid) || (currentPage == 3 && (!isServiceSelected() || filterVisible)) || importingApi || savingAPI || (currentPage == 4 && !productFormValid())" data-ng-click="save()">{{::'done' | translate}}</button>
  </div>
</div>
