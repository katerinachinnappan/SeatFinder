<!--
/********************************************************* {COPYRIGHT-TOP} ***
* Licensed Materials - Property of IBM
* 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
*
* (C) Copyright IBM Corporation 2017
*
* All Rights Reserved.
* US Government Users Restricted Rights - Use, duplication or disclosure
* restricted by GSA ADP Schedule Contract with IBM Corp.
********************************************************** {COPYRIGHT-END} **/
-->
<div apic-save-key="saveVersionKey()">
    <div class="bannerActions" data-ng-show="!xhrProcessing">
        <div class="dijitInline contentBox" data-ng-if="validationErrors && validationErrors.length > 0" data-ng-show="mainTab !== 'assembly'">
            <div class="buttonAndLabel" style="position: relative; text-align: center;" dropdown data-is-open="validationErrorDropdownOpen" title="{{::'api_validation_errors' | translate}}">
                <button data-ng-disabled="!swaggerDocument || xhrProcessing" id="{{$id}}_validationErrors" aria-label="{{::'api_validation_errors' | translate}}" title="{{::'api_validation_errors' | translate}}" role="button" class="iconOnlyButton dropdown-toggle" dropdown-toggle><div class="material-icons" style="color:red;">error</div></button>
                <div class="dropdown-menu" data-ng-class="{'pull-right':!isMobile()}" style="min-width:400px; padding:10px; text-align:left; text-align: left; max-height: calc(100vh - 110px); overflow-y: auto; overflow-x: hidden;" role="menu" title="{{::'api_validation_errors' | translate}}" onkeypress="validationErrorDropdownOpen = true;">
                    <div style="margin-bottom:20px;">
                        <h3>{{validationErrors.length | translatePlurality: 'api_validation_errors_count': 'length'}}</h3>
                    </div>
                    <ul>
                        <li role="menuitem" data-ng-repeat="error in validationErrors" style="margin-bottom:20px;">
                            <div class="displayInline material-icons" style="color:red; vertical-align:top;">error</div>
                            <div class="displayInline" style="width:calc(100% - 50px); padding-left:10px;">
                                <span>{{error.message}}</span>
                                <br/>
                                <span data-ng-if="error.dataPath">{{error.dataPath}}</span>
                                <span data-ng-if="error.mark && (mainTab == 'code' || mainTab == 'editor')">
                                    <a data-ng-click="goToLine(error.mark.line)">{{'api_validation_show_me' | translate}}</a>
                                </span>
                                <span data-ng-if="error.path && error.path.length > 0 && (mainTab == 'code' || mainTab == 'editor')">
                                    <a data-ng-click="goToPath(error.path)">{{'api_validation_show_me' | translate}}</a>
                                </span>
                                <br/>
                                <span data-ng-if="error.path && error.path.length > 0" class="errorPath">{{error.path | formatPath}}</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="dijitInline contentBox" data-ng-if="validationWarnings && validationWarnings.length > 0" data-ng-show="mainTab !== 'assembly'">
            <div class="buttonAndLabel" style="position: relative; text-align: center;" dropdown data-is-open="validationWarningDropdownOpen" title="{{'moreActions' | translate}}">
                <button data-ng-disabled="!swaggerDocument || xhrProcessing" id="{{$id}}_validationWarnings" aria-label="{{::'api_validation_warnings' | translate}}" title="{{::'api_validation_warnings' | translate}}" role="button" class="iconOnlyButton dropdown-toggle" dropdown-toggle><div class="material-icons" style="color:orange;">warning</div></button>
                <div class="dropdown-menu" data-ng-class="{'pull-right':!isMobile()}" style="min-width:400px; padding:10px; text-align:left; text-align: left; max-height: calc(100vh - 110px); overflow-y: auto; overflow-x: hidden;" role="menu" title="{{'api_validation_warnings' | translate}}" onkeypress="validationWarningDropdownOpen = true;">
                    <div style="margin-bottom:20px;">
                        <h3>{{validationWarnings.length | translatePlurality: 'api_validation_warnings_count': 'length'}}</h3>
                    </div>
                    <ul>
                        <li role="menuitem" data-ng-repeat="warning in validationWarnings" style="margin-bottom:20px;">
                            <div class="displayInline material-icons" style="color:orange; vertical-align:top;">warning</div>
                            <div class="displayInline" style="width:calc(100% - 50px); padding-left:10px;">
                                <span>{{warning.message}}</span>
                                <br/>
                                <span data-ng-if="warning.dataPath">{{warning.dataPath}}</span>
                                <span data-ng-if="warning.mark && (mainTab == 'code' || mainTab == 'editor')">
                                    <a data-ng-click="goToLine(warning.mark.line)">{{'api_validation_show_me' | translate}}</a>
                                </span>
                                <span data-ng-if="warning.path && warning.path.length > 0 && (mainTab == 'code' || mainTab == 'editor')">
                                    <a data-ng-click="goToPath(warning.path)">{{'api_validation_show_me' | translate}}</a>
                                </span>
                                <br/>
                                <span data-ng-if="warning.path && warning.path.length > 0" class="errorPath">{{warning.path | formatPath}}</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

      <div class="dijitInline contentBox validateButton" data-ng-show="editable && mainTab !== 'assembly'">
        <div class="buttonAndLabel" style="position: relative; text-align: center;" title="{{'policy.validate.title' | translate}}">
          <button aria-label="{{::'policy.validate.title' | translate}}" title="{{::'policy.validate.title' | translate}}" data-ng-disabled="apiInFlux || validateDisabled" data-ng-click="validateApi()" class="highVisButton iconOnlyButton"><div class="material-icons">check_circle</div></button>
        </div>
      </div>
        <div class="dijitInline contentBox saveButton" data-ng-show="editable">
            <div class="buttonAndLabel" style="position: relative; text-align: center;" title="{{'save' | translate}}">
                <button aria-label="{{::'save' | translate}}" title="{{::'save' | translate}}" data-ng-disabled="apiInFlux || invalidInfo || !checkDirtyApi() || missingRequiredFields" data-ng-click="saveVersion()" class="highVisButton iconOnlyButton"><div class="material-icons">save</div></button>
            </div>
        </div>

        <div class="dijitInline contentBox moreButton">
            <bx-overflow-menu title="{{::'moreActions' | translate}}" class="design-api-overflow-btn tooltipContainer">
                    <bx-overflow-menu-item id="generateProductTag"  item-text="{{ ::'tour-title-generateDefaultProduct' | translate}}" data-ng-show="editable && permissions['org_draftProducts/edit']" data-ng-click="generateDefaultProduct()" tooltip="{{::'tour-content-generateDefaultProduct' | translate}}" tooltip-placement="left" tooltip-trigger="generateProductEvent" >
                    </bx-overflow-menu-item>
                    <bx-overflow-menu-item item-text="{{ ::'product_add_api_to_existing' | translate}}" data-ng-show="editable && permissions['org_draftProducts/view']" data-ng-click="addToExistingProducts()">
                    </bx-overflow-menu-item>
                    <bx-overflow-menu-item item-text="{{::'saveAsANewVersion' | translate}}" data-ng-show="editable" data-ng-click="createNewVersion()">
                    </bx-overflow-menu-item>
                    <bx-overflow-menu-item item-text="{{::'update' | translate}}" data-ng-show="editable" data-ng-click="updateVersion()" data-ng-if="!offlineMode">
                    </bx-overflow-menu-item>
                    <bx-overflow-menu-item item-text="{{::'downloadSwagger' | translate}}" data-ng-click="downloadApi()" data-ng-if="!offlineMode">
                    </bx-overflow-menu-item>
                    <bx-overflow-menu-item item-text="{{::'apiDeleteVersion' | translate}}" warn-user="true" data-ng-show="editable" data-ng-click="deleteVersion();">
                    </bx-overflow-menu-item>
            </bx-overflow-menu>
            <iframe style="display:none;" ng-src="{{downloadFrame}}" title="{{::'apiDownloadFrameTitle' | translate}}"></iframe>
        </div>
    </div>
    <section data-ng-class="{'spinner': xhrProcessing}" class="apiEditor">
        <div data-ng-show="swaggerDocument" class="stretch underMainBanner amp-margin">
            <div class="toc stretch" style="width:250px; vertical-align:top;" data-ng-show="mainTab == 'code' || mainTab == 'editor'">
                <ul>
                    <li class="tocItem"><a class='toc-navigate-info' data-ng-click="navigate('info')">{{::'api_info' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-schemes' data-ng-click="navigate('schemes')">{{::'api_schemes' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-host' data-ng-click="navigate('host')">{{::'api_host' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-basePath' data-ng-click="navigate('basePath')">{{::'api_base_path' | translate}}</a></li>
                    <li class="tocItem" data-ng-show="swaggerDocument['x-ibm-configuration'].oauth2"><a class='toc-navigate-oauth' data-ng-click="navigate('oauth')">{{::'api_oauth' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-consumes' data-ng-click="navigate('consumes')">{{::'api_consumes' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-produces' data-ng-click="navigate('produces')">{{::'api_produces' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-x-ibm-configuration' data-ng-click="navigate('x-ibm-configuration')">{{::'api_lifecycle' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-x-ibm-configuration-assembly' data-ng-click="navigate('x-ibm-configuration', 'assembly')">{{::'api_policy_assembly' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-securityDefinitions' data-ng-click="navigate('securityDefinitions')">{{::'api_security_definitions' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-security' data-ng-click="navigate('security')">{{::'api_security' | translate}}</a></li>
                    <li class="tocItem" data-ng-if="features.vendorExtensions"><a class='toc-navigate-vendor-extensions' data-ng-click="navigate('vendor-extensions')">{{::'api_extension_title' | translate}}</a></li>
                    <li>
                        <ul>
                            <li class="tocItem" data-ng-repeat="vendorExtension in vendorExtensions">
                                <a class="truncate" title="{{vendorExtension.title}}" class='toc-navigate-{{::vendorExtension.name}}' data-ng-click="navigate(vendorExtension.name)">{{vendorExtension.name}}</a>
                            </li>
                        </ul>
                    </li>
                    <li class="tocItem"><a class='toc-navigate-properties toc-navigate-x-ibm-configuration-properties' data-ng-click="navigate('x-ibm-configuration', 'properties')">{{::'api_properties_title' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-paths' data-ng-click="navigate('paths')">{{::'api_paths' | translate}}</a></li>
                    <li>
                        <ul>
                            <li class="tocItem" data-ng-repeat="(pathName, path) in swaggerDocument.paths">
                                <a title="{{pathName}}" class='truncate toc-navigate-paths-{{::cleanUpKey(pathName)}}' data-ng-click="navigate('paths', pathName, true)">{{pathName}}</a>
                            </li>
                        </ul>
                    </li>
                    <li data-ng-if="features.analyticsSection" class="tocItem"><a class='toc-navigate-analytics toc-navigate-x-ibm-configuration-analytics' data-ng-click="navigate('x-ibm-configuration', 'analytics')">{{::'api_analytics' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-parameters' data-ng-click="navigate('parameters')">{{::'api_parameters' | translate}}</a></li>
                    <li>
                        <ul>
                            <li class="tocItem" data-ng-repeat="(parameterName, parameter) in swaggerDocument.parameters">
                                <a title="{{parameterName}}" class='truncate toc-navigate-parameters-{{::parameterName}}' data-ng-click="navigate('parameters', parameterName)">{{parameterName}}</a>
                            </li>
                        </ul>
                    </li>
                    <li class="tocItem"><a class='toc-navigate-definitions' data-ng-click="navigate('definitions')">{{::'api_definitions' | translate}}</a></li>
                    <li>
                        <ul>
                            <li class="tocItem" data-ng-repeat="(definitionName, definition) in swaggerDocument.definitions">
                                <a title="{{::definitionName}}" class='truncate toc-navigate-definitions-{{::cleanUpKey(definitionName)}}' data-ng-click="navigate('definitions', definitionName)">{{::definitionName}}</a>
                            </li>
                        </ul>
                    </li>
                    <li data-ng-if="features.offlineWSDL" class="tocItem"><a class='toc-navigate-webservices' data-ng-click="navigate('webservices')">{{::'api_web_services' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-tags' data-ng-click="navigate('tags')">{{::'api_tags' | translate}}</a></li>
                    <li class="tocItem"><a class='toc-navigate-categories' data-ng-click="navigate('categories')">{{::'api_categories' | translate}}</a></li>
                </ul>
            </div>
            <div data-ng-if="mainTab == 'code'">
                <div class="stretch absolutelyFabulous" style="left:250px;">
                    <div id="ace-api-editor" ui-view="editor" class="editor-wrapper ace_editor ace-atom-dark ace_dark" ng-model="$root.apiValue" ui-ace="{useWrapMode: true, mode: 'yaml', theme: 'atom_dark', onLoad: aceLoaded, onChange: aceChanged}" data-ng-readonly="!offlineMode && !editable"></div>
                </div>
            </div>
            <div data-ng-if="mainTab == 'editor'" class="stretch" style="left:250px; width: calc(100% - 250px);" in-view-container>
                <apim-api-editor></apim-api-editor>
            </div>
            <div data-ng-if="mainTab == 'assembly'">
                <apim-assembler data-assembler-options='{"policies": "ApimPolicyFactory", "references": "documentReferences", "source": "swaggerDocument", "property": "x-ibm-configuration", "externalAssemblies": "externalAssemblies", "schema": "swaggerSchema", "test": true, "gateways": true, "templates": true, "versioning": true}'></apim-assembler>
            </div>
            <div data-ng-if="mainTab == 'explore'">
                <apim-api-explorer></apim-api-explorer>
            </div>
        </div>
    </section>
</div>
