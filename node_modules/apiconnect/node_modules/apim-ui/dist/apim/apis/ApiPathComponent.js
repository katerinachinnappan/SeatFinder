/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2015, 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apim-ui

'use strict';

angular.module('apim.apis').component('apiPath', {
  bindings: {
    name: '<',
    path: '<',
    pathSet: '<',
    xIbmConfig: '<',
    apiSecurityDefns: '<',
    apiTags: '<',
    apiParameters: '<',
    parameterTypes: '<',
    allTypes: '<',
    definitions: '<',
    renamePath: '&',
    onDelete: '&',
    onChange: '&'
  },
  templateUrl: 'apim/apis/partials/api-path-component.html',
  controllerAs: 'pathCtrl',
  controller: function($filter, $rootScope) {
    var $ctrl = this;

    this.$onInit = function() {
      $ctrl.features = $rootScope.features || {};
    };

    this.delete = function($event) {
      $event.stopPropagation();
      $ctrl.onDelete({
        name: $ctrl.name
      });
    };

    this.$pathName = function(name) {
      // Getter
      if (arguments.length === 0) {
        return $ctrl.name;
      }
      // Setter
      if (name && $ctrl.pathSet.hasOwnProperty(name)) {
        return $ctrl.tempName = name;
      }

      $ctrl.tempName = null;

      $ctrl.renamePath({
        oldName: $ctrl.name,
        newName: name
      });

      $ctrl.name = name;
    }

    this.update = function($event) {
      if ($event) {
        $event.stopPropagation();
      }

      $ctrl.onChange({
        name: $ctrl.name,
        value: $ctrl.path
      })
    }

    this.isExpanded = function() {
      return Boolean($ctrl._expanded);
    };

    this.setExpanded = function() {
      $ctrl._expanded = !($ctrl.isExpanded());
    };
  }
});
