/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apim-ui

'use strict';
var apis = angular.module('apim.apis');

apis.factory('validateWorkerFunctionFactory', function () {

  function workerFunction() {
    var self = this;

    self.onmessage = function(event) {
      self.validateWorker;
      self.api = event.data.api;
      self.vendorExtensions = event.data.vendorExtensions;
      var slash = event.data.url.slice(-1) === '/' ? '' : '/';
      self.importScripts(event.data.url + slash + 'js/validateWorker.js');
    }
  };

  return {
    getWebworkerFunction: function () {
      return workerFunction;
    }
  }
});

apis.factory('validateWorkerFactory', function ($window) {

  function createWorker(workerFunction) {
    var dataObj = '(' + workerFunction + ')();';
    var blob = new $window.Blob([dataObj]);

    var blobURL = URL.createObjectURL(blob, {
      type: 'application/javascript; charset=utf-8'
    });
    return new Worker(blobURL);
  };

  return {
    createWorker: createWorker
  }
});
