/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2016, 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apim-ui

'use strict';

angular.module('apim.targetLogin').controller('TargetLoginController', ['$scope', '$http', '$filter', '$timeout', '$q', 'FormFactor', loginController]);

function loginController($scope, $http, $filter, $timeout, $q, FormFactor) {
  function getURLParameter(param) {
    var regexString = "[\\#&\\?]" + param + "=([^&#\\?]*)",
      regex = new RegExp(regexString),
      results = regex.exec(window.location.href);

    return ((results == null) ? "" : results[1]);
  }

  $scope.focusBox = function(elementId) {
    var element = document.getElementById(elementId);
    if (element) {
      $timeout(function() {
        element.focus();
      });
    }
  };

  $scope.ready = true;

  $scope.targetLoginError = getURLParameter('error');
  $scope.targetLoginURL = encodeURI(getURLParameter('loginURL') + '/auth?redirectURL=' + window.location.protocol + window.location.host + '/auth/targetCallback?authEndpoint=' + getURLParameter('loginURL'));

  if(!getURLParameter('error')){
    try {
      window.opener.onSuccessMessage(true);
    } catch (err) {
    }

    window.close();
  }

  window.history.pushState("", "Title", "/targetLogin.html");


}

