/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2015, 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apim-ui

'use strict';

angular.module('apim.core').controller('LoginDialogController', ['$rootScope', '$scope', '$mdDialog', '$http', '$q', 'outerScope', loginDialogController]);

function loginDialogController($rootScope, $scope, $mdDialog, $http, $q, outerScope) {
  $scope.login = {};
  $scope.signIn = function() {
    var def = performLogin();
    def.then(function() {
      $mdDialog.cancel();
      $rootScope.loginOpen = false;
      $rootScope.$broadcast('event:loginSuccess');
    });
  };

  function performLogin() {
    $scope.loggingIn = true;
    var ret = $q.defer();
    var data = "j_username=" + encodeURIComponent($scope.login.name) + "&j_password=" + encodeURIComponent($scope.login.password);
    var config = {
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
        "X-Requested-With": "XMLHttpRequest"
      },
      ignoreHttpCheck: true
    };
    $http.post("j_security_check", data, config).success(function(data) {
      ret.resolve(data);
    }).error(function(err) {
      $scope.loggingIn = false;
    });
    return (ret.promise);
  };
};

