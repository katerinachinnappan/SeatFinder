<!--
/********************************************************* {COPYRIGHT-TOP} ***
* Licensed Materials - Property of IBM
* 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
*
* (C) Copyright IBM Corporation 2017
*
* All Rights Reserved.
* US Government Users Restricted Rights - Use, duplication or disclosure
* restricted by GSA ADP Schedule Contract with IBM Corp.
********************************************************** {COPYRIGHT-END} **/
-->
<div class="productPlanEditor secondaryBorder all" style="margin:10px 0px;" data-ng-controller="ProductPlanEditor" data-ui-on-drop="planDropped($data, node, $index)">
	<section data-ng-show="!shouldShowPlanContent(planName)" class="clickable productSection secondaryBorder all secondaryBackground secondaryHighlight" style="padding: 10px;" data-ng-click="showPlanContent(planName)" data-drag="planName" data-ui-draggable="true">
		<div class="productSettingsExpander">
      <button style="display: block;" class="mediumButton textOnlyButton" title="{{::'ttExpand' | translate}}">
        <div class="webapiIcon maximizeIcon transition200" data-ng-class="{'rotate270': !shouldShowPlanContent(planName)}"></div>
      </button>
		</div>
    <div class="productSettingsDelete floatRight">
      <button class="mediumButton iconOnlyButton hoverVisible" data-ng-click="deletePlan($event, planName);" title="{{::'ttDelete' | translate}}">
        <div class="material-icons">delete</div>
      </button>
    </div>
    <div class="productSettingsTitle displayInline alignTop" style="max-width: 90%;">
      <div style="font-size: large;">{{(plan.title ? plan.title : planName)}}</div>
      <div class="boundedText">{{plan | planSummary: features.monetization}}</div>
    </div>
	</section>
	<section data-ng-show="shouldShowPlanContent(planName)" class="clickable productSection secondaryBorder all secondaryBackground secondaryHighlight" style="padding: 10px;" data-ng-click="showPlanContent(planName)">
		<div class="productSettingsExpander">
      <button style="display: block;" class="mediumButton textOnlyButton" title="{{::'ttExpand' | translate}}">
        <div class="webapiIcon maximizeIcon transition200" data-ng-class="{'rotate270': !shouldShowPlanContent(planName)}"></div>
      </button>
		</div>
    <div class="productSettingsDelete floatRight">
      <button style="display: block;" class="mediumButton iconOnlyButton" data-ng-click="deletePlan($event, planName);" title="{{::'ttDelete' | translate}}">
        <div class="material-icons">delete</div>
      </button>
    </div>
    <bx-input-container class="bx--form__row-item displayInline" data-ng-click="$event.stopPropagation()">
      <label for="{{$id}}_planTitle">{{::'product_title' | translate}}</label>
      <input id="{{$id}}_planTitle" data-ng-model="plan.title"/>
    </bx-input-container>
	</section>
	<section data-ng-if="shouldShowPlanContent(planName)" class="productSection" style="padding: 10px 20px;">
    <bx-input-container>
      <label for="{{$id}}_planName">{{::'product_name' | translate}}</label>
      <input id="{{$id}}_planName" data-ng-model="name" data-ng-model-options="{getterSetter:true, updateOn:'blur'}" data-ng-keyUp="setDirty(true)"/>
    </bx-input-container>
    <bx-input-container>
      <label for="{{$id}}_planDescription">{{::'product_description' | translate}}</label>
      <input id="{{$id}}_planDescription" data-ng-model="plan.description"/>
    </bx-input-container>
    <!-- Billing Model Section -->
    <div id="billing" ng-if="features.monetization">
      <label class="bx--form__label">{{::'monetizationModel' | translate}}</label>
      <select class="bx--select__input" ng-if="false" id="billingModel" data-ng-model="plan['billing-model'].model" data-ng-change="setDirty(true)">
        <option class="bx--select__option" value="none">{{::'none' | translate}}</option>
        <option class="bx--select__option" value="stripe_monthly_fixed">{{::'monetizationSubscription' | translate}}</option>
      </select>
      <select class="bx--select__input" id="displayModel" data-ng-model="models[planName]" data-ng-change="updateBillingPlan(models[planName])">
        <option class="bx--select__option" value="none">{{::'none' | translate}}</option>
        <option class="bx--select__option" value="stripe_monthly_fixed">{{::'monetizationSubscription' | translate}}</option>
      </select>
      <div style="margin-left:25px;" data-ng-if="models[planName] === 'stripe_monthly_fixed'">
        <label class="bx--form__label">{{::'monetizationCurrency' | translate}}</label>
        <select class="bx--select__input" id="currency" ng-options="currency.code as currency.label | translate for currency in currencies" data-ng-model="plan['billing-model'].currency" data-ng-change="setDirty(true); changeCurrency()">
        </select>
        <div class="bx--form__row-item">
          <label class="mandatory bx--form__label-required bx--form__label">{{::'monetizationMonthlyPrice' | translate}}</label>
          <button class="material-icons iconOnlyButton alignMiddle infoIcon infoIconTopMargin" data-ng-click="showTooltip = !showTooltip" data-tooltip-is-open="showTooltip" data-tooltip-html-unsafe={{currencyTooltip}} data-tooltip-placement="right">info_outline</button>
          <bx-input-currency type="number" min="0" required="true" id="amount" data-ng-model="amounts.amount"/>
        </div>
        <div class="bx--form__row-item">
          <label class="mandatory bx--form__label-required bx--form__label">{{::'monetizationTrial' | translate}}</label>
          <bx-input-number type="number" min="0" required="true" id="trial-period-days" data-ng-model="plan['billing-model']['trial-period-days']"/>
        </div>
      </div>
    </div>
    <!-- Rate Limits Section -->
		<div class="bx--form__row-item">
			<div class="productSettingsRateLimit">
				<label class="bx--form__label">{{::'product_rate_limits' | translate}}</label>
				<button style="vertical-align: bottom;" data-ng-disabled="!editable" data-ng-click="addRateLimit()" class="displayInline iconOnlyButton material-icons" title="{{::'product_rate_limit_add' | translate}}" aria-label="{{::'product_rate_limit_add' | translate}}">add_circle_outline</button>
				<div data-ng-if="plan['rate-limit']">
          <apim-rate-limit model="plan['rate-limit']"></apim-rate-limit>
          <button style="vertical-align: bottom; height: 45px; float: right; padding-left: 5px;" data-ng-disabled="!editable" data-ng-click="deleteRateLimit();" class="displayInline iconOnlyButton material-icons" title="{{::'product_rate_limit_add' | translate}}" aria-label="{{::'product_rate_limit_delete' | translate}}">delete</button>
			  </div>
			  <div data-ng-repeat="(rateLimitName, rateLimit) in plan['rate-limits']" data-ng-controller="NamedRateLimitController">
					<input id="{{$id}}_rateLimitName" class="bx--text__input" type="text" data-ng-model="$rateLimitName" data-ng-model-options="{getterSetter:true, updateOn:'blur'}" style="width: 20%; display: inline-flex;" data-ng-keyUp="setDirty(true)" title="{{::'productRateLimitName' | translate}}"/>
          <apim-rate-limit style="display: inline-flex;" model="rateLimit"></apim-rate-limit>
          <button style="vertical-align: bottom; height: 45px; float: right; padding-left: 5px;" data-ng-disabled="!editable" data-ng-click="deleteRateLimit(rateLimitName)" class="displayInline iconOnlyButton material-icons" title="{{::'product_rate_limit_delete' | translate}}" aria-label="{{::'product_rate_limit_delete' | translate}}">delete</button>
			  </div>
			  <div data-ng-if="unlimitedRateLimit()">{{'rateLimitUnlimited' | translate}}</div>
			</div>
		</div>
    <!-- Burst Limits Section -->
		<div class="bx--form__row-item">
			<div class="productSettingsRateLimit">
        <label class="bx--form__label">{{::'product_burst_limits' | translate}}</label>
        <button style="vertical-align: bottom;" data-ng-disabled="!editable" data-ng-click="addBurstLimit()" class="displayInline iconOnlyButton material-icons" title="{{::'product_burst_limit_add' | translate}}" aria-label="{{::'product_burst_limit_add' | translate}}">add_circle_outline</button>
				<div data-ng-repeat="(burstLimitName, burstLimit) in plan['burst-limits']" data-ng-controller="NamedBurstLimitController">
					<input id="{{$id}}_burstLimitName" class="bx--text__input" type="text" data-ng-model="$burstLimitName" data-ng-model-options="{getterSetter:true, updateOn:'blur'}" style="width: 20%; display: inline-flex;" data-ng-keyUp="setDirty(true)" title="{{::'productBurstLimitName' | translate}}"/>
          <apim-burst-limit style="display: inline-flex; margin-right: 20px;" model="burstLimit"></apim-burst-limit>
          <button style="vertical-align: bottom; height: 45px; float: right; padding-left: 5px;" data-ng-disabled="!editable" data-ng-click="deleteBurstLimit(burstLimitName)" class="displayInline iconOnlyButton material-icons" title="{{::'product_burst_limit_delete' | translate}}" aria-label="{{::'product_burst_limit_delete' | translate}}">delete</button>
        </div>
        <div data-ng-if="!plan['burst-limits'] || plan['burst-limits'].length == 0">{{'product_burst_limit_none' | translate}}</div>
			</div>
		</div>
		<div class="bx--form__row-item">
			<div class="productSettingsApproval">
        <label class="bx--form__label">{{::'productApproval' | translate}}</label>
       	<bx-checkbox data-ng-model="plan.approval">{{::'product_require_subscription_approval' | translate}}</bx-checkbox>
	    </div>
		</div>
	</section>
	<section data-ng-if="shouldShowPlanContent(planName)" class="productSection" style="padding-left:12px;">
		<div class="bx--form__row-item">
      <label class="bx--form__label">{{plan.apis | countApis: product.apis | translatePlurality: 'product_plan_apis_included': 'count'}}</label>
			<span class="floatRight" style="margin-right: 20px;">
       	<bx-checkbox data-ng-model="showSelectedOnly">{{::'product_show_selected_only' | translate}}</bx-checkbox>
			</span>
		</div>
		<div class="clearBoth"></div>
		<section class="planApiDetails bx--form__row-item">
			<div class="loadingAnimation38" data-ng-show="xhrProcessing" style="margin-bottom: 20px;"></div>
      <ul class="simpleList">
	      <li class='emptyCollectionMessage padding10' data-ng-if="!xhrProcessing && !product.apis">{{::'noPlanResourcesAddedYet' | translate}}</li>
        <li data-ng-if="!xhrProcessing" data-ng-repeat="(apiName, api) in product.apis">
          <apim-product-plan-api-editor></apim-product-plan-api-editor>
        </li>
      </ul>
    </section>
	</section>
</div>
