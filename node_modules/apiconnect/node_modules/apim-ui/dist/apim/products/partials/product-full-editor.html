<!--
/********************************************************* {COPYRIGHT-TOP} ***
* Licensed Materials - Property of IBM
* 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
*
* (C) Copyright IBM Corporation 2017
*
* All Rights Reserved.
* US Government Users Restricted Rights - Use, duplication or disclosure
* restricted by GSA ADP Schedule Contract with IBM Corp.
********************************************************** {COPYRIGHT-END} **/
-->
<section apic-save-key="saveVersion()" data-ng-controller="ProductEditorController" class="">
    <div class="bannerActions" data-ng-show="!xhrProcessingProduct">

        <div class="dijitInline contentBox" data-ng-if="validationErrors && validationErrors.length > 0">
            <div class="buttonAndLabel" style="position: relative; text-align: center;" dropdown data-is-open="validationErrorDropdownOpen" title="{{::'api_validation_errors' | translate}}">
                <button data-ng-disabled="!product || xhrProcessing" id="{{$id}}_validationErrors" aria-label="{{::'api_validation_errors' | translate}}" title="{{::'api_validation_errors' | translate}}" role="button" class="iconOnlyButton dropdown-toggle" dropdown-toggle><div class="material-icons" style="color:red;">error</div></button>
                <div class="dropdown-menu" data-ng-class="{'pull-right':!isMobile()}" style="min-width:400px; padding:10px; text-align:left; text-align: left; max-height: calc(100vh - 110px); overflow-y: auto; overflow-x: hidden;" role="menu" title="{{::'api_validation_errors' | translate}}" onkeypress="validationErrorDropdownOpen = true;">
                    <div style="margin-bottom:20px;">
                        <h3>{{validationErrors.length | translatePlurality: 'api_validation_errors_count': 'length'}}</h3>
                    </div>
                    <ul>
                        <li role="menuitem" data-ng-repeat="error in validationErrors" style="margin-bottom:20px;">
                            <div class="displayInline material-icons" style="color:red; vertical-align:top;">error</div>
                            <div class="displayInline" style="width:calc(100% - 50px); padding-left:10px;">
                                <span>{{error.message}}</span>
                                <br/>
                                <span data-ng-if="error.dataPath">{{error.dataPath}}</span>
                                <span data-ng-if="error.mark && (mainTab == 'code' || mainTab == 'editor')">
                                    <a data-ng-click="goToLine(error.mark.line)">{{'api_validation_show_me' | translate}}</a>
                                </span>
                                <span data-ng-if="error.path && error.path.length > 0 && (mainTab == 'code' || mainTab == 'editor')">
                                    <a data-ng-click="goToPath(error.path)">{{'api_validation_show_me' | translate}}</a>
                                </span>
                                <br/>
                                <div data-ng-repeat="subError in error.subErrors">
                                  <span>{{subError.message}}</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="dijitInline contentBox" data-ng-if="validationWarnings && validationWarnings.length > 0">
            <div class="buttonAndLabel" style="position: relative; text-align: center;" dropdown data-is-open="validationWarningDropdownOpen" title="{{'moreActions' | translate}}">
                <button data-ng-disabled="!product || xhrProcessing" id="{{$id}}_validationWarnings" aria-label="{{::'api_validation_warnings' | translate}}" title="{{::'api_validation_warnings' | translate}}" role="button" class="iconOnlyButton dropdown-toggle" dropdown-toggle><div class="material-icons" style="color:orange;">warning</div></button>
                <div class="dropdown-menu" data-ng-class="{'pull-right':!isMobile()}" style="min-width:400px; padding:10px; text-align:left; text-align: left; max-height: calc(100vh - 110px); overflow-y: auto; overflow-x: hidden;" role="menu" title="{{'api_validation_warnings' | translate}}" onkeypress="validationWarningDropdownOpen = true;">
                    <div style="margin-bottom:20px;">
                        <h3>{{validationWarnings.length | translatePlurality: 'api_validation_warnings_count': 'length'}}</h3>
                    </div>
                    <ul>
                        <li role="menuitem" data-ng-repeat="warning in validationWarnings" style="margin-bottom:20px;">
                            <div class="displayInline material-icons" style="color:orange; vertical-align:top;">warning</div>
                            <div class="displayInline" style="width:calc(100% - 50px); padding-left:10px;">
                                <span>{{warning.message}}</span>
                                <br/>
                                <span data-ng-if="warning.dataPath">{{warning.dataPath}}</span>
                                <span data-ng-if="warning.mark">
                                    <a data-ng-click="goToLine(warning.mark.line)">{{'api_validation_show_me' | translate}}</a>
                                </span>
                                <span data-ng-if="warning.path && warning.path.length > 0">
                                    <a data-ng-click="goToPath(warning.path)">{{'api_validation_show_me' | translate}}</a>
                                </span>
                                <br/>
                                <span data-ng-if="warning.path && warning.path.length > 0" class="errorPath">{{warning.path | formatPath}}</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    	<div class="dijitInline contentBox" data-ng-if="!offlineMode">
    		<div class="buttonAndLabel" style="position: relative; text-align: inherit;" dropdown data-is-open="deploymentDropdownOpen">
    			<button data-ng-disabled="!product || xhrProcessing || !permissions['<<_deploymentAnyEnv_>>/stage'] && !permissions['{{environments[0].id}}/<<_deploymentAnySpace_>>/stage'] || publishTargets.length == 0" id="{{$id}}_deploy" aria-label="{{::'apiDeployTitle' | translate}}" title="{{::'apiDeployTitle' | translate}}" role="button" class="iconOnlyButton dropdown-toggle" dropdown-toggle><div class="material-icons">cloud_upload</div></button>
    			<ul class="dropdown-menu" style="max-height: 50vh; overflow-y: auto;" data-ng-class="{'pull-right':!isMobile()}" role="menu" onkeypress="deploymentDropdownOpen = true;">
    				<li role="menuitem" data-ng-repeat="publishTarget in publishTargets | orderBy: ['environmentTitle', 'spaceTitle']">
              <a href="" data-ng-keypress="stageVersion(publishTarget);">
        			  <div class='deployedProduct selectable clickable {{descriptors | deploymentStateForPublishTarget: publishTarget}}' data-ng-click="stageVersion(publishTarget);">
        				  <div class='dijitInline deployedIndicator' title='{{descriptors | deploymentStateForPublishTarget: publishTarget | translate}}'></div>
        					<div class='dijitInline boundedText environmentName' style="max-width: 160px;" title='{{publishTarget.displayAs}}'>{{publishTarget.displayAs}}</div>
                  <div style="font-size: smaller; margin-left: 14px;" data-ng-if="isOffline()">{{environment.baseUrl}}</div>
        					<div class='floatRight undeploy'></div>
        					<div class='clearBoth'></div>
        				</div>
              </a>
    				</li>
    			</ul>
    		</div>
        </div>
        <div class="dijitInline contentBox saveButton" data-ng-show="editable">
          <div class="buttonAndLabel" style="position: relative; text-align: center;" title="{{::'save' | translate}}">
            <button data-ng-disabled="productInFlux || !checkDirtyProduct()" data-ng-click="saveVersion()" aria-label="{{::'save' | translate}}" title="{{::'save' | translate}}" class="highVisButton iconOnlyButton"><div class="material-icons">save</div></button>
          </div>
        </div>
        <div class="dijitInline contentBox">
            <bx-overflow-menu title="{{::'moreActions' | translate}}">
                    <bx-overflow-menu-item item-text="{{::'saveAsANewVersion' | translate}}" data-ng-click="createNewVersion()" data-ng-show="editable">
                    </bx-overflow-menu-item>
                    <bx-overflow-menu-item item-text="{{::'update' | translate}}" data-ng-show="editable" data-ng-click="updateVersion()" data-ng-if="!offlineMode">
                    </bx-overflow-menu-item>
                    <bx-overflow-menu-item item-text="{{::'downloadSwagger' | translate}}" data-ng-click="downloadProduct()" data-ng-if="!offlineMode">
                    </bx-overflow-menu-item>
                    <bx-overflow-menu-item item-text="{{::'apiDeleteVersion' | translate}}" warn-user="true" data-ng-show="editable" data-ng-click="deleteVersion();">
                    </bx-overflow-menu-item>
            </bx-overflow-menu>
            <iframe style="display:none;" ng-src="{{downloadFrame}}" title="{{::'apiDownloadFrameTitle' | translate}}"></iframe>
        </div>
    </div>
    <div data-ng-show="!xhrProcessingProduct && !xhrProcessingApis" class="stretch underMainBanner amp-margin">
        <div class="toc stretch">
            <ul>
                <li class="tocItem"><a data-ng-class="{'selected': selectedPath == 'info'}" data-ng-click="navigate('info')">{{::'product_info' | translate}}</a></li>
                <li>
                    <ul>
                        <li class="tocItem"><a data-ng-class="{'selected': selectedPath == 'info-contact'}" data-ng-click="navigate('info-contact')">{{::'product_contact_information' | translate}}</a></li>
                        <li class="tocItem"><a data-ng-class="{'selected': selectedPath == 'info-license'}" data-ng-click="navigate('info-license')">{{::'product_license' | translate}}</a></li>
                        <li class="tocItem"><a data-ng-class="{'selected': selectedPath == 'info-termsOfService'}" data-ng-click="navigate('info-termsOfService')">{{::'product_terms_of_service' | translate}}</a></li>
                    </ul>
                </li>
                <li class="tocItem"><a data-ng-class="{'selected': selectedPath == 'visibility'}" data-ng-click="navigate('visibility')">{{::'product_settings_default_visibility_label' | translate}}</a></li>
                <li class="tocItem"><a data-ng-class="{'selected': selectedPath == 'apis'}" data-ng-click="navigate('apis')">{{::'apis' | translate}}</a></li>
                <li>
                    <ul>
                        <li class="tocItem" data-ng-repeat="api in product.apis" data-ng-controller=ProductApiTocController>
                            <a class="truncate" title="{{::apiName}}" data-ng-class="{'selected': selectedPath == ('apis-' + apiKey)}" data-ng-click="navigate('apis-' + apiKey)">{{apiName}}</a>
                        </li>
                    </ul>
                </li>
                <li class="tocItem"><a data-ng-class="{'selected': selectedPath == 'plans'}" data-ng-click="navigate('plans')">{{::'plans' | translate}}</a></li>
                <li>
                    <ul>
                        <li class="tocItem" data-ng-repeat="(planName, plan) in product.plans">
                            <a class="truncate" title="{{plan.title}}" data-ng-class="{'selected': selectedPath == ('plans-' + planName)}" data-ng-click="navigate('plans-' + planName)">{{plan.title}}</a>
                        </li>
                    </ul>
                </li>
                <li class="tocItem"><a data-ng-class="{'selected': selectedPath == 'categories'}" data-ng-click="navigate('categories')">{{::'product_categories' | translate}}</a></li>
            </ul>
        </div>
        <div data-ng-show="mainTab == 'code'">
            <div class="stretch" style="left:250px; background-color: white;">
                <div id="ace-product-editor" ui-view="editor" class="editor-wrapper ace_editor ace-atom-dark ace_dark" style="height:100%;" ng-model="$root.productValue" ui-ace="{useWrapMode: true, mode: 'yaml', theme: 'atom_dark', onLoad: aceLoaded, onChange: aceChanged}" data-ng-readonly="!offlineMode && !editable"></div>
            </div>
        </div>
        <div class="bx--stretch-editor" data-ng-show="mainTab == 'editor'" style="width: calc(100% - 250px); overflow:auto; left:250px;" in-view-container>
            <apim-product-editor>
        </div>
    </div>
    <div data-ng-class="{'spinner': (xhrProcessingProduct || xhrProcessingApis)}">
    </div>
</section>
