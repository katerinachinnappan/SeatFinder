/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apim-ui

'use strict';

/**
  *
  * @ngdoc module
  * @name bluemix.components
  *
  * @description
  *
  * Bluemix Carbon Components module.
  *
  **/
  angular.module('bluemix.components')

/**
  *
  * @ngdoc directive
  * @name bluemix.components.component:bxDetailPageHeader
  *
  * @description
  *
  * Detail page header is used to label the page and act as a form of
  * navigation.
  *
  * The Detail Page Header appears at the top of the page, and provides context
  * to the content below.
  *
  * Animation
  *
  * The header above the content area extends across the entire viewport. When
  * the user scrolls, the header shrinks to preserve vertical real estate. The
  * title will hide while the tabs persist along to top of the viewport.
  *
  * @example
  *
  * <bx-detail-page-header
  *   title="'Watson API'"
  *   back-link="'/apis'"
  *   back-link-title="'APIS'">
  * </bx-detail-page-header>
  *
  * @param {string} title the text displayed as the header
  * @param {string} backLink the HREF the backlink will go to
  * @param {string} backLinkTitle what the back link title is
  * @param {boolean} animated controls the animation when sliding
  *
  **/
  .component('bxDetailPageHeader', {
    templateUrl: 'apim/bluemix/components/detail-page-header/detail-page-header.html',
    bindings: {
      title: '@',
      backLink: '@',
      backLinkTitle: '@',
      animated: '@'
    },
    transclude: true,
    controller: DetailPageHeaderCtrl
  });

/* ngInject */
  function DetailPageHeaderCtrl ($transclude) {
    var $ctrl = this;

    $transclude(function(clone) {
      $ctrl.hasTabs = clone.toArray().some(function(tabs) {
        return Boolean(
          tabs.nodeName === 'BX-TABS' &&
          angular.element(tabs).find('bx-tab').length > 0
        );
      });
    });

    $ctrl.headerClass = 'bx--detail-page-header--';
    $ctrl.headerClass += $ctrl.hasTabs ? 'with-tabs' : 'no-tabs';

    $ctrl.$onInit = function() {
      $ctrl.backLinkText = $ctrl.backLinkText || 'Back';

      if ($ctrl.hasTabs && $ctrl.animated) {
        $ctrl.headerClass += ' ' + $ctrl.headerClass + '--animated';
      }
    };
  }

