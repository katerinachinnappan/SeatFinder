/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2015, 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apim-ui

'use strict';

/* Controllers */

var apps = angular.module('apim.apps', ['ngResource']);

apps.controller('AppsCtrl', ['$scope', 'App', appsController]);

function appsController($scope, App) {
};

apps.controller('AppSubscriptionController', ['$scope', 'App', appSubscriptionController]);

function appSubscriptionController($scope) {
  $scope.versionSubscription.selected = true;
  var matchingOrgs = $scope.developerOrgs.filter(function(org) {
    return (org.id == $scope.versionSubscription.app.orgId);
  });
  if (matchingOrgs.length > 0) $scope.developerOrg = matchingOrgs[0];
};

apps.controller('AppCreateController', ['$scope', '$modalInstance', 'ProviderApp', AppCreateController]);

function AppCreateController($scope, $modalInstance, ProviderApp) {
  var self = this;

  $scope.done = function() {
    $scope.creatingApp = false;
    $modalInstance.close();
  };

  $scope.cancel = function() {
    $scope.creatingApp = false;
    $modalInstance.dismiss();
  };

  $scope.create = function() {
    var app = new ProviderApp({name: $scope.newAppForm.name, description: $scope.newAppForm.description});
    var saveArgs = {
      orgId: $scope.orgId,
      envId: $scope.environment.id
    };
    if ($scope.spaceId) {
      saveArgs.spaces = "spaces";
      saveArgs.spaceId = $scope.spaceId;
    }
    app.$save(saveArgs).then(
      function(application) {
        $scope.application = application;
      },
      function() {
        $scope.creatingApp = false;
      }
    );
  };
};

