/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/

// Node module: apiconnect-config-to-datapower

'use strict';
const coname = require('./coname');

module.exports = exports = function(sub, options) {
  function APISubscription() {
    this.subscriber = new APISubscriber();
    this._name = coname.subscription(options, this.subscriber);
    this._plan = new APIPlan();
    this.plans = [];
  }

  function APISubscriber() {
    let cred = sub.application['app-credentials'][0];
    this.id = cred['client-id'];
    this.hashedSecret = cred['client-secret'];
    this.name = sub.application.title;
    if (sub.application['oauth-redirection-uri'])
      this.oauthRedirectionUri = sub.application['oauth-redirection-uri'];
    if (sub.application['oauth-client-type'])
      this.oauthClientType = sub.application['oauth-client-type'];
  }

  function APIPlan() {
    let product = sub['plan-registration'].product.document;
    let name = sub['plan-registration'].plan.name;
    this._name = coname.plan(options, product, name);
  }

  return new APISubscription();
};
