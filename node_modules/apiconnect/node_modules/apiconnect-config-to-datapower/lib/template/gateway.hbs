{{!--
/********************************************************* {COPYRIGHT-TOP} ***
  * Licensed Materials - Property of IBM
  * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
  *
  * (C) Copyright IBM Corporation 2017
  *
  * All Rights Reserved.
  * US Government Users Restricted Rights - Use, duplication or disclosure
  * restricted by GSA ADP Schedule Contract with IBM Corp.
  ********************************************************** {COPYRIGHT-END} **/
--}}

{{#with fshHttp}}
source-http {{_name}}
  reset
  allowed-features HTTP-1.0+HTTP-1.1+POST+GET+PUT+DELETE+OPTIONS+HEAD+QueryString+FragmentIdentifiers
  local-address :: {{port}}
exit
{{/with}}

{{#with fshHttps}}
{{#with cert.password}}
password-alias {{_name}}
  reset
  password {{password}}
exit
{{/with}}

{{#with key.password}}
password-alias {{_name}}
  reset
  password {{password}}
exit
{{/with}}

crypto
  certificate "{{cert._name}}" "{{cert.url}}" {{#if cert.password}}password {{cert.password._name}}{{/if}} {{#if cert.ignoreExpiration}}ignore-expiration{{/if}}
  key "{{key._name}}" "{{key.url}}" {{#if key.password}}password {{key.password._name}}{{/if}}
  idcred "{{idcred._name}}" "{{key._name}}" "{{cert._name}}"
  ssl-server "{{sslServer._name}}"
    reset
    protocols "TLSv1d0+TLSv1d1+TLSv1d2"
    ciphers ECDHE_RSA_WITH_AES_256_GCM_SHA384
    ciphers ECDHE_RSA_WITH_AES_256_CBC_SHA384
    ciphers ECDHE_RSA_WITH_AES_256_CBC_SHA
    ciphers DHE_DSS_WITH_AES_256_GCM_SHA384
    ciphers DHE_RSA_WITH_AES_256_GCM_SHA384
    ciphers DHE_RSA_WITH_AES_256_CBC_SHA256
    ciphers DHE_DSS_WITH_AES_256_CBC_SHA256
    ciphers DHE_RSA_WITH_AES_256_CBC_SHA
    ciphers DHE_DSS_WITH_AES_256_CBC_SHA
    ciphers RSA_WITH_AES_256_GCM_SHA384
    ciphers RSA_WITH_AES_256_CBC_SHA256
    ciphers RSA_WITH_AES_256_CBC_SHA
    ciphers ECDHE_RSA_WITH_AES_128_GCM_SHA256
    ciphers ECDHE_RSA_WITH_AES_128_CBC_SHA256
    ciphers ECDHE_RSA_WITH_AES_128_CBC_SHA
    ciphers DHE_DSS_WITH_AES_128_GCM_SHA256
    ciphers DHE_RSA_WITH_AES_128_GCM_SHA256
    ciphers DHE_RSA_WITH_AES_128_CBC_SHA256
    ciphers DHE_DSS_WITH_AES_128_CBC_SHA256
    ciphers DHE_RSA_WITH_AES_128_CBC_SHA
    ciphers DHE_DSS_WITH_AES_128_CBC_SHA
    ciphers RSA_WITH_AES_128_GCM_SHA256
    ciphers RSA_WITH_AES_128_CBC_SHA256
    ciphers RSA_WITH_AES_128_CBC_SHA
    ciphers ECDHE_RSA_WITH_3DES_EDE_CBC_SHA
    ciphers DHE_RSA_WITH_3DES_EDE_CBC_SHA
    ciphers DHE_DSS_WITH_3DES_EDE_CBC_SHA
    ciphers RSA_WITH_3DES_EDE_CBC_SHA
    idcred {{idcred._name}}
    no request-client-auth
    require-client-auth
    no validate-client-cert
    send-client-auth-ca-list
    caching
    cache-timeout 300
    cache-size 20
    ssl-options ""
    max-duration 60
    max-renegotiation-allowed 0
    no prohibit-resume-on-reneg
    no compression
    no allow-legacy-renegotiation
    prefer-server-ciphers
    curves secp521r1
    curves secp384r1
    curves secp256k1
    curves secp256r1
  exit
exit

source-https {{_name}}
  reset
  allowed-features HTTP-1.0+HTTP-1.1+POST+GET+PUT+DELETE+OPTIONS+HEAD+QueryString+FragmentIdentifiers
  local-address :: {{port}}
  http-client-version HTTP/1.1
  ssl-config-type server
  ssl-server {{sslServer._name}}
exit
{{/with}}

xml-manager "xmlmgr_{{_name}}"
 user-agent default
exit

documentcache "xmlmgr_{{_name}}"
 no policy
 static-document-calls on
 maxdocs 5000
 size 4194304
 policy local:///*.json 128 900
exit

apigw {{_name}}
  reset
  {{#if fshHttp}}
  front-protocol {{fshHttp._name}}
  {{/if}}
  {{#if fshHttps}}
  front-protocol {{fshHttps._name}}
  {{/if}}
  {{#each collections}}
  collection {{_name}}
  {{/each}}
  xml-manager xmlmgr_{{_name}}
exit
