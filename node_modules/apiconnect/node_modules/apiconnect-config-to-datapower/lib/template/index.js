/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/

// Node module: apiconnect-config-to-datapower

'use strict';

const fs = require('fs');
const path = require('path');
const hbs = require('handlebars');

require('./helper');

function trimBlankLines(content) {
  let result = [];
  let prevIsExit = false;
  content.split('\n').forEach((line) => {
    if (!prevIsExit && line.trim().length == 0) return;
    result.push(line);
    prevIsExit = line.match(/\bexit\b|^##/);
  });
  return result.join('\n');
};

fs.readdirSync(__dirname)
  .forEach(filename => {
    let m = filename.match(/^(.*)\.hbs$/);
    if (!m) return;
    let template = hbs.compile(
          fs.readFileSync(`${__dirname}/${filename}`, 'utf8'));
    exports[m[1]] = data => trimBlankLines(template(data));
  });
