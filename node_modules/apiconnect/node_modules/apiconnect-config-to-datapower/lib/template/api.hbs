{{!--
/********************************************************* {COPYRIGHT-TOP} ***
  * Licensed Materials - Property of IBM
  * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
  *
  * (C) Copyright IBM Corporation 2017
  *
  * All Rights Reserved.
  * US Government Users Restricted Rights - Use, duplication or disclosure
  * restricted by GSA ADP Schedule Contract with IBM Corp.
  ********************************************************** {COPYRIGHT-END} **/
--}}
########
## catalog={{_catalog}}
## api={{api._api}}
####
{{#each api.securityDefinitions}}
{{#if (eq type 'apiKey')}}
api-sec-apikey {{_name}}
  reset
  where {{-lowercase in}}
  type {{_keyType}}
  key-name {{name}}
exit

{{/if}}
{{#if (eq type 'basic')}}
api-sec-basic-auth {{_name}}
  reset
  {{#if x-ibm-authentication-url}}
  option auth-url
  auth-url {{x-ibm-authentication-url.url}}
  {{#if x-ibm-authentication-url.tls-profile}}
  ssl-client {{x-ibm-authentication-url.tls-profile}}
  {{/if}}{{/if}}
  {{#if x-ibm-authentication-registry}}
  option ldap
  ldap-reg {{x-ibm-authentication-registry}}
  {{/if}}
exit

{{/if}}
{{#if (eq type 'oauth2')}}
api-sec-oauth {{_name}}
  reset
  oauth-provider {{_OAuthProviderSettingsName}}
  oauth-flow {{_flow}}
  oauth-scope {{_scopes}}
exit

{{/if}}
{{/each}}
{{#each api.securityRequirements}}
api-sec-req {{_name}}
  reset
  {{#each securities}}
  security {{_name}}
  {{/each}}
exit

{{/each}}
{{#each api.paths}}

########
## path={{path}}
####
{{#each operations}}
{{#each securityRequirements}}
api-sec-req {{_name}}
  reset
  {{#each securities}}
  security {{_name}}
  {{/each}}
exit

{{/each}}
api-operation {{_name}}
  reset
  method {{method}}
  {{#if operationId}}operation-id "{{operationId}}"{{/if}}
  {{#each parameters}}
  parameter "{{name}}" {{required}} {{type}} {{-lowercase in}} {{format}}
  {{/each}}
  {{#if removeSecurity}}
  remove-security on
  {{/if}}
  {{#each securityRequirements}}
  security {{_name}}
  {{/each}}
exit

{{/each}}
api-path {{_name}}
  reset
  path "{{path}}"
  {{#each operations}}
  operation {{_name}}
  {{/each}}
  {{#each parameters}}
  parameter "{{name}}" {{required}} {{type}} {{-lowercase in}} {{format}}
  {{/each}}
exit

{{/each}}
{{#each rules}}
{{#each actions}}
{{> (-deref-action this)}}

{{/each}}

api-rule {{_name}}
  reset
  {{#each actions}}
  action {{_name}}
  {{/each}}
exit

{{/each}}

assembly {{api.assembly._name}}
  reset
  rule {{api.assembly.rule._name}}
  {{#each api.assembly.catches}}
  catch {{error}} {{rule._name}}
  {{/each}}
  {{#if api.assembly.defaultCatch}}
  default-catch {{api.assembly.defaultCatch._name}}
  {{/if}}
exit

api-definition {{api._name}}
  reset
  name "{{api.name}}"
  version  "{{api.version}}"
  base-path "{{api.basePath}}"
  type standard
  {{#if api.activityLog.on}}
  activity-log {{-onoff api.activityLog.on}}
  content {{api.activityLog.content}}
  error-content {{api.activityLog.error-content}}
  {{/if}}  
  {{#each api.paths}}
  path {{_name}}
  {{/each}}
  assembly {{api.assembly._name}}
  {{#each api.properties}}
  property {{name}} {{collection}} "{{{-add-escape value}}}"
  {{/each}}
  {{#each api.securityRequirements}}
  security-req {{_name}}
  {{/each}}
  swagger-location "{{api._swaggerLocation}}"
exit
