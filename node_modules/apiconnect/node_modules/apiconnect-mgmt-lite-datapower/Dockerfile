FROM node:6-alpine

RUN apk add --no-cache openssl

WORKDIR /usr/src/app

COPY ./package.json ./
COPY ./apim-lite lib/
COPY ./common common/

ARG IBM_APICONNECT_NPM_REGISTRY
ENV npm_config_registry ${IBM_APICONNECT_NPM_REGISTRY:-https://registry.npmjs.com}
RUN npm install --prod --quiet --depth 0

ENV NODE_ENV production

RUN mkdir -p /tmp/generated && chown node:node /tmp/generated
USER node

CMD [ "node", "lib/server.js" ]
