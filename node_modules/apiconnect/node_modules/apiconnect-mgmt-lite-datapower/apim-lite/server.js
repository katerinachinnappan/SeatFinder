#!/usr/bin/env node
/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/

// Node module: apiconnect-mgmt-lite-datapower

'use strict';

let Promise = require('bluebird');
let artifacts = require('./artifacts');
let logger = require('../common/logger');
let flushDocCache = require('./flush-doc-cache');

const CONFIG_DIR = process.env.CONFIG_DIR || process.cwd();

let app = require('./apim-app');

function start () {
  return artifacts.load(CONFIG_DIR, flushDocCache)
    .then(() => app.start(flushDocCache));
}

exports.start = start;

if (require.main === module)
  start().catch(err => {
    logger.error(err);
    logger.error('Exiting with 1');
    process.exit(1);
  });
