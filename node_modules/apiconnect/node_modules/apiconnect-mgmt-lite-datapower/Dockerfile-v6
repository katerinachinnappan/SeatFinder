FROM node:6-alpine

RUN apk add --no-cache openssl

WORKDIR /usr/src/app

COPY package.json ./
COPY ./apim-lite lib/
COPY ./common common/

ARG IBM_APICONNECT_NPM_REGISTRY
ENV npm_config_registry ${IBM_APICONNECT_NPM_REGISTRY:-https://registry.npmjs.com}
RUN npm install --prod --quiet --depth 0

ENV NODE_ENV production

RUN mkdir -p /tmp/generated/local && chown node:node /tmp/generated/local
RUN mkdir -p /tmp/generated/usrcerts && chown node:node /tmp/generated/usrcerts
USER node

CMD [ "node", "lib/gateway-director.js" ]
