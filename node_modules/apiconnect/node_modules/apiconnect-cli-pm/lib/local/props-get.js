/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2016, 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apiconnect-cli-pm

'use strict';

var Promise = require('bluebird');
var _ = require('lodash');
var client = require('./util/client');
var errors = require('./util/errors');
var filter = require('./util/props-filter').filter;
var names = require('./util/name-helper');

module.exports = getProps;

function getProps(propName, otherPropNames, opts) {
  opts = opts || {};
  var propNames = otherPropNames || [];
  propNames.unshift(propName);

  client.init(opts);
  var namesPromise = Promise.resolve(opts.service);
  if (!opts.service) {
    namesPromise = names(null, true);
  }

  return namesPromise.then(function(serviceName) {
    if (!serviceName) {
      throw errors.nonProjectDir('apic props:get');
    }
    return client.getService(serviceName);
  }).then(function(service) {
    var matches = {};
    propNames.forEach(function(item) {
      _.assign(matches, _.pick(service.env, item));
    });
    matches = filter(matches);

    return {
      app: service.name,
      props: matches,
    };
  });
}

