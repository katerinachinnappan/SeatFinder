/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apiconnect-tracking
var apicConfig = require('apiconnect-config');
var segmentIOAgent = require('./segmentio-agent');

/**
 * This tracker wraps the cli base segmentio agent for use by the ui.
 */
module.exports = function tracker(options) {
  options = options || {};
  // When apim-ui calls this when running in dev mode (gulp-serve), this options
  // object will be missing required opts
  if (!options.pkgInfo) {
    options.pkgInfo = { 'product-version': 'dev', version: 'dev' };
  }
  var config = apicConfig.loadConfig();
  var segmentIo = new segmentIOAgent(options);

  function isEnabled() {
    return config.getOne('enable-analytics');
  }
  // Probably can remove as apimui isn't using
  function enable() {
    config.set({ 'enable-analytics': true }, apicConfig.USER_STORE);
  }
  // Probably can remove as apimui isn't using
  function disable() {
    config.delete('enable-analytics', apicConfig.USER_STORE);
  }

  function getTrackingKey() {
    return segmentIo.getTrackingKey();
  };

  return {
    isEnabled: isEnabled,
    enable: enable,
    disable: disable,
    getTrackingKey: getTrackingKey,
  };
};

