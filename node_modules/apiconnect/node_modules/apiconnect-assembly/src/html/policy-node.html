<!-- Templates -->
<script type="text/ng-template" id="errorPopover">
<div class="popoverArrow"></div>
<div data-ng-if="gatewayErrorMessage" class="popoverError">
  {{gatewayErrorMessage}}
</div>
<div data-ng-if="!gatewayErrorMessage" class="popoverError">
  {{errorMessage}}
</div>
</script>

<div
  data-ng-controller="NodeController as NodeController"
  class="policyNode {{node.$$type}} {{node.$$classes.join(' ')}}"
  data-ng-class="{
    'policyWithContent': policyWithContent(),
    'policyGatewayMiss': policyGatewayMiss(),
    'snipped': snipping && node.$$snipped
  }"
>
  <div class="outerShell">
    <div
      data-ng-if="gatewayErrorMessage"
      class="errorShell"
      ns-popover
      ns-popover-template="errorPopover"
      ns-popover-trigger="mouseenter"
      ns-popover-placement="bottom|center"
      ns-popover-timeout="0"
    ><div class="errorIcon"></div></div>
    <div
      data-ng-if="errorMessage && !gatewayErrorMessage && node.$$touched"
      class="errorShell"
      ns-popover
      ns-popover-template="errorPopover"
      ns-popover-trigger="mouseenter"
      ns-popover-placement="bottom|center"
      ns-popover-timeout="0"
    ><div class="errorIcon"></div></div>
    <div
      tabindex="0"
      data-drag="data"
      data-ui-draggable="isDraggable()"
      class="innerShell"
      data-ng-click="nodeSelected($event, node)"
      data-ng-keydown="keyPressed($event, node)"
      data-ng-class="{
        'searchMiss' : !hasMatchedSearch(),
        'searchHit'  : hasMatchedSearch(),
        'isSelected' : node.$$isSelected
      }"
    >
      <div class="nodeHeader">
        <div
          class="iconShell material-icons"
          data-ng-attr-style="background-color: {{node.$$display.color}};"
        >{{node | iconForNode}}</div>
        <div
          class="policyName"
          data-ng-bind-html="node | policyDisplayName | highlight: nodeFilter"
          ng-attr-title="{{node | policyDisplayName}}"
        ></div>
      </div>
      <div class="nodeActionsContainer">
        <div class="closeShell">
          <button
            class="iconOnlyButton material-icons jumpToCode"
            title="{{::'assemblyJumpToSource' | translate}}"
            aria-label="{{::'assemblyJumpToSource' | translate}}"
            data-ng-click="jumpToCode(node.$$type, node.$$instance);"
          >code</button>
          <button
            class="iconOnlyButton material-icons copyNode"
            title="{{::'assembly_clone_node_tooltip' | translate}}"
            aria-label="{{::'assembly_clone_node_tooltip' | translate}}"
            data-ng-click="cloneNode($event, node);"
          >content_copy</button>
          <button
            class="iconOnlyButton material-icons deleteNode"
            style="margin-left: 0px;"
            title="{{::'assembly_delete_node_tooltip' | translate}}"
            aria-label="{{::'assembly_delete_node_tooltip' | translate}}"
            data-ng-click="deleteNode($event, node);"
          >delete</button>
        </div>
      </div>
      <div
        data-ng-if="operationFilter && node.$$operations"
        class="operationCountShell"
        ns-popover
        ns-popover-template="errorPopover"
        ns-popover-trigger="mouseenter"
        ns-popover-placement="bottom|center"
        ns-popover-timeout="0"
      >{{node.$$operations}}</div>
    </div><div class="catchShellContainer" data-ng-if="showCatches && node.catch" data-ng-class="{'emptyClause': isClauseEmpty()}">
      <div data-ng-include="'src/html/catch.html'"></div>
    </div><div class="clauseShellContainer" data-ng-class="{'emptyClause': isClauseEmpty()}">
      <div data-ng-include="'src/html/clause.html'"></div>
    </div>
  </div>
</div><div data-ng-if="node.type == 'response'" class="dropzoneGroup" data-ui-on-drop="policyDropped($data, node, $index)">
</div><div data-ng-if="node.type == 'response'" class="outputNode"></div>
