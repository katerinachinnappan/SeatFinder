<!-- Templates -->
<script data-ng-if="!isAppConnect()" type="text/ng-template" id="errorPopover">
  <div class="popoverArrow"></div>
  <div data-ng-if="gatewayErrorMessage" class="popoverError">
    {{gatewayErrorMessage}}
  </div>
  <div data-ng-if="!gatewayErrorMessage" class="popoverError">
    {{errorMessage}}
  </div>
</script>

<div data-drag="data" data-ui-draggable="isDraggable()" data-ng-keydown="keyPressed($event, node)" data-ng-click="nodeSelected($event, node)" data-ng-controller="NodeController as NodeController" class="policyNode logicNode subflowNode {{node.$$type}} {{node.$$classes.join(' ')}}" data-ng-class="{'policyWithContent': policyWithContent, 'hover-effect' : isHovered, 'policyGatewayMiss': policyGatewayMiss(), 'minimized': node.$$minimized, 'snipped': snipping && node.$$snipped, 'isSelected': node.$$isSelected, 'logic-node__has-branch-selected': node.$$selectedBranch !== undefined}" ng-mouseover="highlightNode(true, $event)" ng-mouseout="highlightNode(false, $event)">
  <div class="outerShell">
    <div data-ng-if="gatewayErrorMessage && !isAppConnect()"
      class="errorShell"
      ns-popover
      ns-popover-template="errorPopover"
      ns-popover-trigger="mouseenter"
      ns-popover-placement="bottom|center"
      ns-popover-timeout="0"
    ><div class="errorIcon"></div></div>
    <div data-ng-if="errorMessage && !gatewayErrorMessage && node.$$touched && !isAppConnect()"
      class="errorShell"
      ns-popover
      ns-popover-template="errorPopover"
      ns-popover-trigger="mouseenter"
      ns-popover-placement="bottom|center"
      ns-popover-timeout="0"
      ><div class="errorIcon"></div></div>
    <div class="innerShell" data-ng-class="{'searchMiss': !hasMatchedSearch(), 'searchHit': hasMatchedSearch()}" data-ng-attr-style="background-color: {{node.$$display.color}};">
      <div data-ng-if="isAppConnect()">
        <appc-node-decorator
          data-node-touched="node.$$touched"
		  data-messages="node.$$errors"
          data-icon-name="exclamation"
		 >
        </appc-node-decorator>
      </div>
      <div class="iconShell iconShellBackground">
        <div ng-if="!isAppConnect()" class="material-icons" style="transform: rotate(-135deg);">{{node | iconForNode}}</div>
        <div ng-if="isAppConnect()" class="logic-node__icon-container">
          <md-icon class="logic-node__icon" md-svg-icon="{{node | iconForNode}}"></md-icon>
        </div>
      </div>
      <div class="policyName" data-ng-bind-html="node | policyDisplayName | highlight: nodeFilter"></div>
      <div ng-if="isAppConnect() && node.$$minimized" class="logic-node__actions-count">{{countInnerActions(node)}} {{::'ifNode.actions' | translate}}</div>
    <div class="nodeActionsContainer">
        <div class="closeShell" data-ng-show="isDraggable()">
          <button data-ng-if="!isAppConnect() && node.$$type !== 'throw' && node.$$minimized" data-ng-click="minimize($event);" class="iconOnlyButton material-icons collapseNode">fullscreen</button>
          <button data-ng-if="!isAppConnect() && node.$$type !== 'throw' && !node.$$minimized" data-ng-click="minimize($event);" class="iconOnlyButton material-icons collapseNode">fullscreen_exit</button>
          <button data-ng-if="isAppConnect() && node.$$minimized" data-ng-click="minimize($event);" class="iconOnlyButton collapseNode" title="{{::'assembly_maximise_node_tooltip' | translate}}" aria-label="{{::'assembly_maximise_node_tooltip' | translate}}">
            <md-icon
            class="node-actions-container__appc-icon"
            md-svg-icon="floweditor:maximize-node"
            ></md-icon>
          </button>
          <button data-ng-if="isAppConnect() && !node.$$minimized" data-ng-click="minimize($event);" class="iconOnlyButton collapseNode" title="{{::'assembly_minimise_node_tooltip' | translate}}" aria-label="{{::'assembly_minimise_node_tooltip' | translate}}">
            <md-icon
            class="node-actions-container__appc-icon"
            md-svg-icon="floweditor:minimize-node"
            ></md-icon>
          </button>
          </button>
          <button data-ng-show="config.components" class="iconOnlyButton material-icons snipNode" title="{{::'assemblySnipNode' | translate}}" aria-label="{{::'assemblySnipNode' | translate}}" data-ng-click="snipNode(node);">content_cut</button>
          <button class="iconOnlyButton material-icons jumpToCode" title="{{::'assemblyJumpToSource' | translate}}" aria-label="{{::'assemblyJumpToSource' | translate}}" data-ng-click="jumpToCode(node.$$type, node.$$instance);">code</button>
          <button data-ng-if="!isAppConnect()" class="iconOnlyButton material-icons copyNode" title="{{::'assembly_clone_node_tooltip' | translate}}" aria-label="{{::'assembly_clone_node_tooltip' | translate}}" data-ng-click="cloneNode($event, node);">content_copy</button>
          <button data-ng-if="!isAppConnect()" class="iconOnlyButton material-icons deleteNode" style="margin-left: 0px;" title="{{::'assembly_delete_node_tooltip' | translate}}" aria-label="{{::'assembly_delete_node_tooltip' | translate}}" data-ng-click="deleteNode($event, node);">delete</button>
          <button data-ng-if="isAppConnect()" class="iconOnlyButton deleteNode" title="{{::'assembly_delete_node_tooltip' | translate}}" aria-label="{{::'assembly_delete_node_tooltip' | translate}}" data-ng-click="deleteNode($event, node);">
            <md-icon
            class="node-actions-container__appc-icon"
            md-svg-icon="floweditor:delete"
            ></md-icon>
          </button>
        </div>
      </div>
      <div data-ng-if="operationFilter && node.$$operations"
        class="operationCountShell"
        ns-popover
        ns-popover-template="errorPopover"
        ns-popover-trigger="mouseenter"
        ns-popover-placement="bottom|center"
        ns-popover-timeout="0"
      >{{node.$$operations}}</div>
    </div><div class="catchShellContainer" data-ng-if="showCatches && node.catch && !node.$$minimized" data-ng-class="{'emptyClause': isClauseEmpty()}">
     <div data-ng-include="'src/html/catch.html'"></div>
    </div><div data-ng-if="!node.$$minimized" class="clauseShellContainer" data-ng-class="{'emptyClause': isClauseEmpty()}">
     <div data-ng-include="'src/html/clause.html'"></div>
    </div>
  </div>
</div><div data-ng-if="node.type == 'response'" class="dropzoneGroup" data-ui-on-drop="policyDropped($data, node, $index)">
</div><div data-ng-if="node.type == 'response'" class="outputNode"></div>
