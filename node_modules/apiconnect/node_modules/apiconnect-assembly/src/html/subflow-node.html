<!-- Templates -->
<script type="text/ng-template" id="errorPopover">
<div class="popoverArrow"></div>
<div data-ng-if="gatewayErrorMessage" class="popoverError">
  {{gatewayErrorMessage}}
</div>
<div data-ng-if="!gatewayErrorMessage" class="popoverError">
  {{errorMessage}}
</div>
</script>

<div data-ng-controller="NodeController as NodeController" class="policyNode subflowNode referenceNode {{node.$$type}} {{node.$$classes.join(' ')}}" data-ng-init="node.$$minimized = true;" data-ng-class="{'policyWithContent': policyWithContent(), 'policyGatewayMiss': policyGatewayMiss(), 'minimized': node.$$minimized, 'snipped': snipping && node.$$snipped}">
  <div class="outerShell">
    <div data-ng-if="gatewayErrorMessage"
      class="errorShell"
      ns-popover
      ns-popover-template="errorPopover"
      ns-popover-trigger="mouseenter"
      ns-popover-placement="bottom|center"
      ns-popover-timeout="0"
    ><div class="errorIcon"></div></div>
    <div data-ng-if="errorMessage && !gatewayErrorMessage && node.$$touched"
      class="errorShell"
      ns-popover
      ns-popover-template="errorPopover"
      ns-popover-trigger="mouseenter"
      ns-popover-placement="bottom|center"
      ns-popover-timeout="0"
      ><div class="errorIcon"></div></div>
    <div data-drag="data" data-ui-draggable="isDraggable()" class="innerShell" data-ng-click="nodeSelected($event, node)" data-ng-keydown="keyPressed($event, node)" data-ng-class="{'searchMiss': !hasMatchedSearch(), 'searchHit': hasMatchedSearch()}">
      <div class="iconShell material-icons">{{node | iconForNode}}</div>
      <div class="policyName" data-ng-bind-html="node | policyDisplayName | highlight: nodeFilter"></div>
      <div class="nodeActionsContainer">
        <div class="closeShell">
          <button data-ng-if="node.$$type !== 'throw' && node.$$minimized" data-ng-click="minimize($event);" class="iconOnlyButton material-icons collapseNode">fullscreen</button>
          <button data-ng-if="node.$$type !== 'throw' && !node.$$minimized" data-ng-click="minimize($event);" class="iconOnlyButton material-icons collapseNode">fullscreen_exit</button>
          <button class="iconOnlyButton material-icons jumpToCode" title="{{::'assemblyJumpToSource' | translate}}" aria-label="{{::'assemblyJumpToSource' | translate}}" data-ng-click="jumpToCode(node.$$type, node.$$instance);">code</button>
          <button class="iconOnlyButton material-icons copyNode" title="{{::'assembly_clone_node_tooltip' | translate}}" aria-label="{{::'assembly_clone_node_tooltip' | translate}}" data-ng-click="cloneNode($event, node);">content_copy</button>
          <button class="iconOnlyButton material-icons deleteNode" style="margin-left: 0px;" title="{{::'assembly_delete_node_tooltip' | translate}}" aria-label="{{::'assembly_delete_node_tooltip' | translate}}" data-ng-click="deleteNode($event, node);">delete</button>
        </div>
      </div>
      <div data-ng-if="operationFilter && node.$$operations"
        class="operationCountShell"
        ns-popover
        ns-popover-template="errorPopover"
        ns-popover-trigger="mouseenter"
        ns-popover-placement="bottom|center"
        ns-popover-timeout="0"
      >{{node.$$operations}}</div>
    </div><div class="clauseShellContainer" data-ng-if="!node.$$minimized" data-ng-class="{'emptyClause': isClauseEmpty()}">
      <div data-ng-include="'src/html/clause.html'"></div>
    </div><div class="catchShellContainer" data-ng-if="showCatches && node.catch && !node.$$minimized" data-ng-class="{'emptyClause': isClauseEmpty()}">
        <div data-ng-include="'src/html/catch.html'"></div>
    </div>
    <div data-ng-if="false">
        <div class="dropzoneGroupSpacer">
        </div><div class="dropzoneGroup" data-ui-on-drop="policyDropped($data, node, $index, -1)">
            <div class="ghostPolicy"></div>
        </div><div class="inlineContainer" data-ng-repeat="node in node.execute | transformNodeModel: policiesByType">
            <div class="inlineContainer"><apim-node></apim-node>
            </div><div class="dropzoneGroupSpacer">
            </div><div data-ng-if="node.type !== 'response' && node.type !== 'throw'" class="dropzoneGroup" data-ui-on-drop="policyDropped($data, $parent.$parent.node, $parent.$parent.$index, $index)">
                <div class="ghostPolicy"></div>
            </div>
        </div><div class="catchShellContainer" data-ng-if="showCatches && node.catch" data-ng-class="{'emptyClause': isClauseEmpty()}">
        <div data-ng-include="'src/html/catch.html'"></div>
        </div>
    </div>
  </div>
</div><div data-ng-if="node.type == 'response'" class="dropzoneGroup" data-ui-on-drop="policyDropped($data, node, $index)">
</div><div data-ng-if="node.type == 'response'" class="outputNode"></div>
