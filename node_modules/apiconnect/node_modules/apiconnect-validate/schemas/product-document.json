{
  "id": "https:\\/\\/api.ibm.com\\/product\\/schema.json#",
  "$schema": "http:\\/\\/json-schema.org\\/draft-04\\/schema#",
  "title": "A schema to represent the IBM specific API configuration",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "product",
    "info"
  ],
  "patternProperties": {
    "^x-": {
      "$ref": "#/definitions/vendorExtension"
    }
  },
  "properties": {
    "product": {
      "type": "string",
      "enum": [
        "1.0.0"
      ]
    },
    "info": {
      "$ref": "#/definitions/InfoSection"
    },
    "visibility": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "view",
        "subscribe"
      ],
      "patternProperties": {
        "^x-": {
          "$ref": "#/definitions/vendorExtension"
        }
      },
      "properties": {
        "view": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "type"
          ],
          "patternProperties": {
            "^x-": {
              "$ref": "#/definitions/vendorExtension"
            }
          },
          "properties": {
            "type": {
              "enum": [
                "public",
                "authenticated",
                "custom"
              ]
            },
            "orgs": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "tags": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "enabled": {
              "type": "boolean"
            }
          }
        },
        "subscribe": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "type"
          ],
          "patternProperties": {
            "^x-": {
              "$ref": "#/definitions/vendorExtension"
            }
          },
          "properties": {
            "type": {
              "enum": [
                "authenticated",
                "custom"
              ]
            },
            "orgs": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "tags": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "enabled": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "apis": {
      "type": "object",
      "patternProperties": {
        "^x-": {
          "$ref": "#/definitions/vendorExtension"
        }
      },
      "additionalProperties": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "$ref": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          }
        }
      }
    },
    "plans": {
      "type": "object",
      "patternProperties": {
        "^x-": {
          "$ref": "#/definitions/vendorExtension"
        }
      },
      "additionalProperties": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "title"
        ],
        "patternProperties": {
          "^x-": {
            "$ref": "#/definitions/vendorExtension"
          }
        },
        "properties": {
          "title": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "approval": {
            "type": "boolean"
          },
          "rate-limit": {
            "$ref": "#/definitions/RateLimitSection"
          },
          "rate-limits": {
            "$ref": "#/definitions/RateLimitsSection"
          },
          "burst-limits": {
            "$ref": "#/definitions/BurstLimitsSection"
          },
          "billing-model": {
            "$ref": "#/definitions/BillingSection"
          },
          "apis": {
            "type": "object",
            "patternProperties": {
              "^x-": {
                "$ref": "#/definitions/vendorExtension"
              }
            },
            "additionalProperties": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "operations": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": false,
                    "patternProperties": {
                      "^x-": {
                        "$ref": "#/definitions/vendorExtension"
                      }
                    },
                    "properties": {
                      "operationId": {
                        "type": "string"
                      },
                      "path": {
                        "type": "string"
                      },
                      "operation": {
                        "type": "string"
                      },
                      "rate-limit": {
                        "$ref": "#/definitions/RateLimitSection"
                      },
                      "rate-limits": {
                        "$ref": "#/definitions/RateLimitsSection"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "InfoSection": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "title",
        "version"
      ],
      "patternProperties": {
        "^x-": {
          "$ref": "#/definitions/vendorExtension"
        }
      },
      "properties": {
        "name": {
          "type": "string"
        },
        "version": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "termsOfService": {
          "type": "string"
        },
        "categories": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "contact": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            "^x-": {
              "$ref": "#/definitions/vendorExtension"
            }
          },
          "properties": {
            "name": {
              "type": "string"
            },
            "url": {
              "type": "string",
              "format": "uri"
            },
            "email": {
              "type": "string",
              "format": "email"
            }
          }
        },
        "license": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            "^x-": {
              "$ref": "#/definitions/vendorExtension"
            }
          },
          "required": [
            "name"
          ],
          "properties": {
            "name": {
              "type": "string"
            },
            "url": {
              "type": "string",
              "format": "uri"
            }
          }
        }
      }
    },
    "RateLimitSection": {
      "type": "object",
      "additionalProperties": false,
      "patternProperties": {
        "^x-": {
          "$ref": "#/definitions/vendorExtension"
        }
      },
      "required": [
        "value"
      ],
      "properties": {
        "value": {
          "type": "string",
          "pattern": "^((\\d+)\\/(\\d+)?(second|minute|hour|day|week)|unlimited)$"
        },
        "hard-limit": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "RateLimitsSection": {
      "type": "object",
      "patternProperties": {
        "^x-": {
          "$ref": "#/definitions/vendorExtension"
        }
      },
      "additionalProperties": {
        "$ref": "#/definitions/RateLimitSection"
      }
    },
    "BurstLimitsSection": {
      "type": "object",
      "patternProperties": {
        "^x-": {
          "$ref": "#/definitions/vendorExtension"
        }
      },
      "additionalProperties": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "value"
        ],
        "patternProperties": {
          "^x-": {
            "$ref": "#/definitions/vendorExtension"
          }
        },
        "properties": {
          "value": {
            "type": "string",
            "pattern": "^((\\d+)\\/(\\d+)?(second|minute))$"
          }
        }
      }
    },
    "BillingSection": {
      "title": "Billing Model",
      "required": [
        "provider",
        "model"
      ],
      "patternProperties": {
        "^x-": {
          "$ref": "#/definitions/vendorExtension"
        }
      },
      "oneOf": [
        {
          "title": "Fixed Monthly Rate via Stripe",
          "required": [
            "amount",
            "currency",
            "trial-period-days"
          ],
          "properties": {
            "provider": {
              "enum": [
                "stripe"
              ]
            },
            "model": {
              "enum": [
                "stripe_monthly_fixed"
              ]
            },
            "amount": {
              "type": "integer",
              "minimum": 0,
              "maximum": 99999999
            },
            "currency": {
              "type": "string",
              "enum": [
                "AUD",
                "CAD",
                "DKK",
                "EUR",
                "GBP",
                "JPY",
                "NOK",
                "SEK",
                "USD"
              ]
            },
            "trial-period-days": {
              "type": "integer",
              "minimum": 0,
              "maximum": 730
            }
          }
        }
      ]
    },
    "vendorExtension": {
      "description": "Any property starting with x- is valid.",
      "additionalProperties": true,
      "additionalItems": true
    }
  }
}
