#-------------------------------------------------------------------
# Product Document
#-------------------------------------------------------------------
id: 'https:\/\/api.ibm.com\/product\/schema.json#'
$schema: 'http:\/\/json-schema.org\/draft-04\/schema#'
title: 'A schema to represent the IBM specific API configuration'
type: object
additionalProperties: false
required:
  - product
  - info
properties:
  product:
    type: string
    enum:
      - '1.0.0'
  info:
    $ref: '#/definitions/InfoSection'
  visibility:
    type: object
    additionalProperties: false
    required:
      - view
      - subscribe
    properties:
      view:
        type: object
        additionalProperties: false
        required:
          - type
        properties:
          type:
            enum:
              - public
              - authenticated
              - custom
          orgs:
            type: array
            items:
              type: string
          tags:
            type: array
            items:
              type: string
          enabled:
            type: boolean
      subscribe:
        type: object
        additionalProperties: false
        required:
          - type
        properties:
          type:
            enum:
              - authenticated
              - custom
          orgs:
            type: array
            items:
              type: string
          tags:
            type: array
            items:
              type: string
          enabled:
            type: boolean
  apis:
    type: object
    additionalProperties:
      type: object
      additionalProperties: false
      properties:
        $ref:
          type: string
        id:
          type: string
        name:
          type: string
  plans:
    type: object
    additionalProperties:
      type: object
      additionalProperties: false
      required:
        - title
      properties:
        title:
          type: string
        description:
          type: string
        approval:
          type: boolean
        rate-limit:
          $ref: '#/definitions/RateLimitSection'
        rate-limits:
          $ref: '#/definitions/RateLimitsSection'
        burst-limits:
          $ref: '#/definitions/BurstLimitsSection'
        billing-model:
          $ref: '#/definitions/BillingSection'
        apis:
          type: object
          additionalProperties:
            type: object
            additionalProperties: false
            properties:
              operations:
                type: array
                items:
                  type: object
                  additionalProperties: false
                  properties:
                    operationId:
                      type: string
                    path:
                      type: string
                    operation:
                      type: string
                    rate-limit:
                      $ref: '#/definitions/RateLimitSection'
                    rate-limits:
                      $ref: '#/definitions/RateLimitsSection'

#=============================================================================
# DEFINITIONS
#=============================================================================
definitions:

#-------------------------------------------------------------------
# Info Section
#-------------------------------------------------------------------
  InfoSection:
    type: object
    additionalProperties: false
    required:
      - title
      - version
    properties:
      name:
        type: string
      version:
        type: string
      title:
        type: string
      description:
        type: string
      termsOfService:
        type: string
      categories:
        type: array
        items:
          type: string
      contact:
        type: object
        additionalProperties: false
        properties:
          name:
            type: string
          url:
            type: string
            format: uri
          email:
            type: string
            format: email
      license:
        type: object
        additionalProperties: false
        required:
          - name
        properties:
          name:
            type: string
          url:
            type: string
            format: uri

#-------------------------------------------------------------------
# Rate Limit Section
#-------------------------------------------------------------------
  RateLimitSection:
    type: object
    additionalProperties: false
    required:
      - value
    properties:
      value:
        type: string
        pattern: '^((\d+)\/(\d+)?(second|minute|hour|day|week)|unlimited)$'
      hard-limit:
        type: boolean
        default: false

#-------------------------------------------------------------------
# Rate Limits Section
#-------------------------------------------------------------------
  RateLimitsSection:
    type: object
        additionalProperties:
          type: object
          oneOf:
          - "$ref": "#/definitions/RateLimitSection"

#-------------------------------------------------------------------
# Burst Limits Section
#-------------------------------------------------------------------
  BurstLimitsSection:
    type: object
    additionalProperties:
      type: object
      additionalProperties: false
      required:
        - value
      properties:
        value:
          type: string
          pattern: "^((\\d+)\\/(\\d+)?(second|minute))$"

#-------------------------------------------------------------------
# Billing Section
#-------------------------------------------------------------------
  BillingSection:
    type: object
    additionalProperties: false
    required:
    - provider
    - type
    oneOf:
    - title: Fixed Monthly Rate via Stripe
      properties:
        provider:
          enum:
          - stripe
        model:
          enum:
          - stripe_monthly_fixed
        amount:
          type: integer
          minimum: 0
          maximum: 99999999
        currency:
          type: string
          enum:
          - AUD
          - CAD
          - DKK
          - EUR
          - GBP
          - JPY
          - NOK
          - SEK
          - USD
        trial-period-days:
          type: integer
          minimum: 0
          maximum: 730
