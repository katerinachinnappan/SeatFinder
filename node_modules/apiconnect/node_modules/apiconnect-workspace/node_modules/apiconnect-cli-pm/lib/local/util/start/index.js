/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2016, 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apiconnect-cli-pm

'use strict';

var debug = require('debug')('apiconnect-cli-pm:start');
var Promise = require('bluebird');
var deploy = Promise.promisify(require('strong-deploy').local);
var Pm = Promise.promisifyAll(require('./pm'));

module.exports = start;

function start(appDir, serviceName) {
  var pm = new Pm();

  return pm.startAsync().then(function run(logAt) {
    debug('deploy to %j app %j (name: %s)', pm.url, appDir, serviceName);
    return deploy({
      baseURL: pm.url,
      serviceName: serviceName,
      branchOrPack: appDir,
      clusterSize: -1,
    });
  });
};

